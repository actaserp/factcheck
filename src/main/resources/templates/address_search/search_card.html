<!DOCTYPE html>
<html lang="ko">
<style>

    /*.layout-contents {*/
    /*    position: relative; !* ë‚´ë¶€ ìš”ì†Œê°€ ë°°ê²½ ìœ„ì— ë°°ì¹˜ë  ìˆ˜ ìˆë„ë¡ ì„¤ì • *!*/
    /*    background-image: url('/img/cardBackImg.png'); !* ë°°ê²½ ì´ë¯¸ì§€ ê²½ë¡œ *!*/
    /*    background-size: cover; !* ì „ì²´ë¥¼ ë®ë„ë¡ ì„¤ì • *!*/
    /*    background-position: center; !* ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ ì •ë ¬ *!*/
    /*    background-repeat: no-repeat; !* ë°˜ë³µ ë°©ì§€ *!*/
    /*    width: 100%;*/
    /*    min-height: 100vh; !* í™”ë©´ ì „ì²´ ë†’ì´ ì°¨ì§€ *!*/
    /*    display: flex;*/
    /*    flex-direction: column;*/
    /*    justify-content: center;*/
    /*    align-items: center;*/
    /*}*/

    /*!* í•˜ìœ„ ìš”ì†Œ ìŠ¤íƒ€ì¼ *!*/
    /*.layout-contents .contents-wrap,*/
    /*.layout-contents #addressWrap {*/
    /*    position: relative; !* ë°°ê²½ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • *!*/
    /*    !*background: rgba(255, 255, 255, 0.8); !* ë°˜íˆ¬ëª… ë°°ê²½ ì¶”ê°€ (ê°€ë…ì„±) *!*!*/
    /*    padding: 20px;*/
    /*    border-radius: 10px;*/
    /*    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);*/
    /*    width: 90%;*/
    /*    max-width: 600px;*/
    /*    text-align: center;*/
    /*}*/

    .btn-clear {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }
    .btn-close {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }
    .card {
        margin-top: 20px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        transition: transform 0.3s, box-shadow 0.3s;
        height: 400px;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }

    .card-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }

    .card-content {
        font-size: 14px;
        color: #555;
    }
    /* íŒì—… í™œì„±í™” ì‹œ */
    .popup-wrapper.active {
        transform: translateX(-50%) translateY(0); /* ğŸ“Œ í™”ë©´ ì•„ë˜ì—ì„œ ì˜¬ë¼ì˜¤ë„ë¡ ì„¤ì • */
        opacity: 1; /* ë³´ì´ë„ë¡ ì„¤ì • */
    }
    .popup-wrapper2.active {
        transform: translateX(-50%) translateY(0); /* ğŸ“Œ í™”ë©´ ì•„ë˜ì—ì„œ ì˜¬ë¼ì˜¤ë„ë¡ ì„¤ì • */
        opacity: 1; /* ë³´ì´ë„ë¡ ì„¤ì • */
    }
    /* íŒì—… ë°°ê²½ (ì–´ë‘¡ê²Œ ì²˜ë¦¬) */
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5); /* ğŸ“Œ ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ ë°°ê²½ */
        z-index: 59; /* íŒì—…ë³´ë‹¤ í•œ ë‹¨ê³„ ë‚®ê²Œ ì„¤ì • */
        display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
    }

    /* íŒì—…ì´ í™œì„±í™”ë  ë•Œ ë°°ê²½ í‘œì‹œ */
    .popup-overlay.active {
        display: block;
    }
    .card-content {
        white-space: pre-line; /* âœ… ì¤„ë°”ê¿ˆ ë°˜ì˜ */
    }
/*    ì¹´ë“œ css ë¶€ë¶„*/
    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(to bottom, #ffebf1, #e6b9d4);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
    }

    /* ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
    .card-container {
        display: flex;
        justify-content: center;
    }

    /*  !* ì¹´ë“œ ìŠ¤íƒ€ì¼ *!
      .card {
          background: white;
          border-radius: 15px;
          padding: 20px;
          width: 320px;
          text-align: center;
          box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
          border: 2px solid #dca3c3;
          outline: 3px solid #dca3c3; !* ë¶„í™ìƒ‰ í…Œë‘ë¦¬ ì¶”ê°€ *!
          outline-offset: -5px; !* í…Œë‘ë¦¬ë¥¼ ì•ˆìª½ìœ¼ë¡œ *!
          position: relative;
      }*/


    .card {
        position: relative;
        background: white;
        border-radius: 15px;
        padding: 20px;
        width: 350px;
        text-align: center;
        outline: 3px solid #dca3c3;
        outline-offset: -10px;
    }

    .card::before {
        content: "";
        position: absolute;
        top: -8px;
        left: -8px;
        right: -8px;
        bottom: -8px;
        /*border: 3px solid #dca3c3;*/
        border-radius: 18px;
        z-index: -2; /* ë°°ê²½ ë’¤ë¡œ */
    }

    /* ìƒë‹¨ ì œëª© */
    .card-header h3 {
        font-size: 14px;
        color: gray;
        margin-bottom: 5px;
    }

    .card-header h2 {
        font-size: 18px;
        font-weight: bold;
        color: black;
        margin-bottom: 10px;
    }

    /* "ì•ˆì‹¬" ë°°ì§€ */
    .safety-badge {
        background: #e8b4c9;
        color: white;
        display: inline-block;
        padding: 5px 15px;
        border-radius: 15px;
        font-size: 14px;
        font-weight: bold;
    }

    /* ì ìˆ˜ */
    .score {
        font-size: 48px;
        font-weight: bold;
        margin: 10px 0;
    }

    .score-value {
        color: black;
    }

    /* ì„¤ëª… ëª©ë¡ */
    .card-info {
        list-style: none;
        padding: 0;
    }

    .card-info li {
        text-align: left;
        font-size: 14px;
        color: black;
        margin-bottom: 5px;
    }

    /* ë‚ ì§œ */
    .date {
        font-size: 12px;
        color: gray;
        margin-top: 10px;
    }

    /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
    .btn-container {
        margin-top: 20px;
    }

    button {
        background-color: #d679a1;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
    }

    button:hover {
        background-color: #b65b84;
    }
</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FACT CHECK</title>
    <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
    <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->
    <script th:inline="javascript">
        var sandanData = /*[[${session.sandanList}]]*/ [];
    </script>


    <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>

    <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>

    <script src="/js/common.js?v=1060"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
    <script src="/js/Mobile.js"></script>
</head>

<body>
<div class="mobile-wrapper page-ticket-list"><!-- â˜…í˜ì´ì§€ Classëª… -->
    <!-- [ëª¨ë°”ì¼] í—¤ë”  -->
    <div class="mobile-layout-header">
        <header>
            <div class="left">
                <a href="#" title="ì „ì²´ë©”ë‰´" class="logo">
                </a>
            </div>
            <div class="left" style="margin-left:35px;">
                <h2>FACT CHECK</h2>
            </div>
            <div class="right">
                <a href="#" title="ì „ì²´ë©”ë‰´" class="btn-menu">
                    <img src="/assets_mobile/images/icon/btn-menu.svg" alt="ì „ì²´ë©”ë‰´ ì•„ì´ì½˜">
                </a>
            </div>
        </header>
    </div> <!-- //mobile-layout-header end-->

    <!-- [ëª¨ë°”ì¼] ë©”ë‰´  -->
    <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>
    <!-- [ëª¨ë°”ì¼] ì»¨ë´ì¸   -->
    <div class="mobile-layout-contents">
        <input type="hidden" id="REALID">
        <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
        <div class="layout-contents">
            <!-- ê²€ìƒ‰ ì˜ì—­  -->
<!--            <div class="search-wrap">-->
<!--            </div>-->
            <!-- ì»¨í…ì¸  ì˜ì—­  -->
            <div class="contents-wrap" style="display: flex; justify-content: center">
            </div> <!--// contents-wrap end-->
            <div id="addressWrap" class="contents-wrap">

            </div>
            <div style="text-align: center">
                <button onclick="cardDetail()" style="margin-top: 10px; width: 100px; margin-left: auto">ìƒì„¸ë³´ê¸°</button>
                <button onclick="deductionDetail()" style="margin-top: 10px; width: 100px;">ì ìˆ˜ì´ë ¥</button>
                <button onclick="window.location.href = '/'" style="margin-top: 10px; width: 100px;">ë‹¤ì‹œì¡°íšŒ</button>
            </div>
        </div> <!--//layout-contents end -->
    </div> <!-- //mobile-layout-contents end-->
    <!-- íŒì—… ë°°ê²½ (í´ë¦­ ì°¨ë‹¨ + ì–´ë‘¡ê²Œ) -->
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="mobile-layout-popup" id="popup-history">
        <!--<div class="popup-overlay"></div>-->
        <div class="popup-wrapper" id="deductionWrap">
            <div class="popup-title">
                <h3>ì ìˆ˜ì´ë ¥</h3>
            </div>
            <div class="popup-contents">
                <div class="table-wrap" style="width: 600px">
                    <div class="write-wrap">
                        <section>
                            <div class="tab-wrap" style="width: 100%;">
                                <ul class="tab-links" style="margin-bottom: 10px;">
                                </ul>

                                <section class="tab-item">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                    <label>ë“±ê¸°ëª©ì </label>
                                                </th>
                                                <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                    <label>ê¸ˆì•¡</label>
                                                </th>
                                                <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                    <label>ì ìˆ˜</label>
                                                </th>
                                                <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                    <label>ê¸°ì¤€</label>
                                                </th>
                                                <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                    <label>ì„ ìˆœìœ„</label>
                                                </th>
                                                <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                    <label>ë‚ ì§œ</label>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="scoreItems">

                                        </tbody>
                                    </table>
                                </section>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close btn-navy" id="closePopup">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div class="mobile-layout-popup" id="popup-history2">
        <!--<div class="popup-overlay"></div>-->
        <div class="popup-wrapper" id="scoreWrapper">
            <div class="popup-title">
                <h3>ìƒì„¸ë³´ê¸°</h3>
            </div>
            <div class="popup-contents">
                <div class="table-wrap" style="width: 600px">
                    <div class="write-wrap">
                        <section class="tab-item">
                            <div class="tab-wrap" style="width: 100%;">
                                <ul class="tab-links" style="margin-bottom: 10px;">
                                </ul>

                                <section class="tab-item">
                                    <table>
                                        <thead>
                                        <tr>
                                            <th style="text-align: center; width: 20%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>ë“±ê¸°ëª©ì </label>
                                            </th>
                                            <th style="text-align: center; width: 37%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>COMMENT</label>
                                            </th>
                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>ë‚ ì§œ</label>
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody id="scoreItems2">

                                        </tbody>
                                    </table>
                                </section>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close btn-navy" id="closePopup2">í™•ì¸</button>
            </div>
        </div>
    </div>
</div> <!-- //page-wrapper end-->

<script th:inline="javascript">
    // // Thymeleafì—ì„œ ê°’ ì„¤ì •: Null ì²´í¬ì™€ ê¸°ë³¸ê°’ ì²˜ë¦¬
    // var groupid = [[${session.groupid != null ? session.groupid : 'null'}]];
    // var id = /*[[${id != null ? id : 'null'}]]*/;
    // var groupname = /*[[${groupname != null ? groupname : 'null'}]]*/;
    // var username = /*[[${username != null ? username : 'null'}]]*/;
    //
    // // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê°’ ìœ ì§€ (null ë˜ëŠ” ë¹ˆ ë¬¸ìì—´ì€ ì €ì¥í•˜ì§€ ì•ŠìŒ)
    // if (groupid && groupid !== 'null') localStorage.setItem('groupid', groupid);
    // if (id && id !== 'null') localStorage.setItem('id', id);
    // if (username && username !== 'null') localStorage.setItem('username', username);
    // if (groupname && groupname !== 'null') localStorage.setItem('groupname', groupname);
</script>


<script type="text/javascript">
    document.readyState === 'complete' ? init() : window.onload = init;
    function init() {
        searchGoyuList();
    }
    // ì„¸ì…˜ê°’ ê°€ì ¸ì™€ ì¹´ë“œ ì¶œë ¥
    function searchGoyuList() {
        let storedData = sessionStorage.getItem("resultMap");

        if (!storedData) {
            console.log("ì„¸ì…˜ ë°ì´í„° ì—†ìŒ.");
            return;
        }

        let parsedData = JSON.parse(storedData);
        console.log("ì„¸ì…˜ì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°:", parsedData);

        const contentsWrap = document.querySelector('.contents-wrap');
        contentsWrap.innerHTML = "";

        let scoreData = parsedData.GRADE;
        const idDocument = document.getElementById('REALID');
        if (idDocument) {
            idDocument.value = parsedData.REALID;
        }

        let htmlContent = `
        <div class="card">
            <div class="card-header">
                <h3>${parsedData.ADDRESS}</h3>
                <div class="safety-badge">${parsedData.GRADE}ë“±ê¸‰</div>
            </div>
            <div class="score">
                <span class="score-value">${parsedData.REALSCORE}</span>ì 
            </div>
    `;

        if (scoreData === "S") {
            htmlContent += `<div class="card-content">ì•ˆì „í•©ë‹ˆë‹¤.</div>`;
        } else {
            htmlContent += `
            <ul class="card-info">
        `;

            let uniqueComments = new Set();

            if (Array.isArray(parsedData.COMMENT)) {
                parsedData.COMMENT.forEach(comment => {
                    const commentText = comment.REGREMARK || 'ì½”ë©˜íŠ¸ ì—†ìŒ';
                    let formattedDate = comment.DATE
                        ? `${comment.DATE.slice(0, 4)}.${comment.DATE.slice(4, 6)}.${comment.DATE.slice(6, 8)}`
                        : 'ë‚ ì§œ ì—†ìŒ';

                    if (!uniqueComments.has(commentText)) {
                        uniqueComments.add(commentText);
                        htmlContent += `
                        <li>âœ”ï¸ ${commentText}</li>
                    `;
                    }
                });
            } else if (parsedData.COMMENT) {
                const commentText = parsedData.COMMENT.REGREMARK || 'ì½”ë©˜íŠ¸ ì—†ìŒ';
                let formattedDate = parsedData.COMMENT.DATE
                    ? `${parsedData.COMMENT.DATE.slice(0, 4)}.${parsedData.COMMENT.DATE.slice(4, 6)}.${parsedData.COMMENT.DATE.slice(6, 8)}`
                    : 'ë‚ ì§œ ì—†ìŒ';

                if (!uniqueComments.has(commentText)) {
                    uniqueComments.add(commentText);
                    htmlContent += `
                    <li>âœ”ï¸ ${commentText}</li>
                `;
                }
            }

            htmlContent += `</ul>`;
        }

        htmlContent += `</div>`; // ì¹´ë“œ ë‹«ê¸°
        contentsWrap.innerHTML = htmlContent;
    }


    // ìƒì„¸ë³´ê¸°
    function cardDetail() {
        $.ajax({
            url: '/api/register/deductionDetail',
            type: 'GET',
            data: {
                "REALID": document.getElementById('REALID').value
            },
            async: false,
            success: function (response) {
                data2 = response.data;
                console.log("data2", data2);

                const scoreWrap = document.getElementById('scoreItems2');
                if (!scoreWrap) {
                    console.error("âŒ ì˜¤ë¥˜: 'scoreItems' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                // "í•­ëª©ì°¨ê°"ì´ ì•„ë‹Œ ë°ì´í„°ë§Œ í•„í„°ë§
                let filteredData = data2.filter(data => data.HISNM !== "í•­ëª©ì°¨ê°");

                let htmlContent = '';
                filteredData.forEach(data => {

                    // ë‚ ì§œ ë³€í™˜ (YYYYMMDD â†’ YYYY.MM.DD)
                    let formattedDate = data.HISDATE
                        ? `${data.HISDATE.slice(0, 4)}.${data.HISDATE.slice(4, 6)}.${data.HISDATE.slice(6, 8)}`
                        : '';

                    htmlContent += `
                    <tr>
                        <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                            ${data.HISNM}
                        </td>
                        <td style="width: 15%; padding: 5px; border: 1px solid #ddd; text-align: left;">
                            ${data.REMARK}
                        </td>
                        <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                            ${formattedDate}
                        </td>
                    </tr>`;
                });

                // ê¸°ì¡´ ë‚´ìš©ì„ ì´ˆê¸°í™” í›„ ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€
                scoreWrap.innerHTML = htmlContent;


            },
            error: function (error) {
                console.error("âŒ API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        });
    }

    // ì ìˆ˜ì´ë ¥ ì¡°íšŒ ë° íŒì—… ì—´ê¸°
    function deductionDetail() {
        let data2 = [];
        $.ajax({
            url: '/api/register/deductionDetail',
            type: 'GET',
            data: {
                "REALID": document.getElementById('REALID').value
            },
            async: false,
            success: function (response) {
                data2 = response.data;
                console.log("data2", data2);

                const scoreWrap = document.getElementById('scoreItems');
                if (!scoreWrap) {
                    console.error("âŒ ì˜¤ë¥˜: 'scoreItems' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                let htmlContent = '';
                data2.forEach(data => {
                    // REGSTAND ê°’ ë³€í™˜
                    let regStandText = "";
                    switch (data.REGSTAND) {
                        case "A1": regStandText = "ê¸ˆì•¡"; break;
                        case "A2": regStandText = "ì ìˆ˜"; break;
                        case "A3": regStandText = "ë³µí•©"; break;
                        default: regStandText = ""; // ë³€í™˜ë˜ì§€ ì•Šì€ ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                    }

                    // HISAMT ê°’ ìˆ«ì í¬ë§·íŒ… (ì²œ ë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€, null ê°’ ê³µë°± ì²˜ë¦¬)
                    let formattedAmt = data.HISAMT ? Number(data.HISAMT).toLocaleString() : "";

                    // HISFLAG ê°’ ë³€í™˜
                    let flagText = data.HISFLAG === "1" ? "O" : "";

                    // ë‚ ì§œ ë³€í™˜ (YYYYMMDD â†’ YYYY.MM.DD)
                    let formattedDate = data.HISDATE
                        ? `${data.HISDATE.slice(0, 4)}.${data.HISDATE.slice(4, 6)}.${data.HISDATE.slice(6, 8)}`
                        : '';

                    htmlContent += `
                <tr>
                    <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                        ${data.HISNM}
                    </td>
                    <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                        ${formattedAmt}
                    </td>
                    <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                        ${data.HISPOINT}
                    </td>
                    <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                        ${regStandText}
                    </td>
                    <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                        ${flagText}
                    </td>
                    <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">
                        ${formattedDate}
                    </td>
                </tr>`;
                });

                // ê¸°ì¡´ ë‚´ìš©ì„ ì´ˆê¸°í™” í›„ ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€
                scoreWrap.innerHTML = htmlContent;

            },
            error: function (error) {
                console.error("âŒ API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        });
    }

    // âœ… íŒì—… ì—´ê¸° (popup-history ìš”ì†Œì— 'open' í´ë˜ìŠ¤ ì¶”ê°€)
    document.addEventListener("DOMContentLoaded", function () {
        const popup = document.getElementById("deductionWrap");
        const popup2 = document.getElementById("scoreWrapper");
        const overlay = document.getElementById("popupOverlay");

        const openButton = document.querySelector("button[onclick='deductionDetail()']"); // íŒì—… ì—´ê¸° ë²„íŠ¼
        const closeButton = document.getElementById("closePopup");
        const openButton2 = document.querySelector("button[onclick='cardDetail()']"); // íŒì—… ì—´ê¸° ë²„íŠ¼
        const closeButton2 = document.getElementById("closePopup2");

        // íŒì—… ì—´ê¸°
        openButton.addEventListener("click", function () {
            console.log("âœ… íŒì—… ì—´ê¸°");
            popup.classList.add("active");
            overlay.classList.add("active"); // ë°°ê²½ ì–´ë‘¡ê²Œ ì„¤ì •
        });

        // íŒì—… ë‹«ê¸°
        closeButton.addEventListener("click", function () {
            console.log("âœ… íŒì—… ë‹«ê¸°");
            popup.classList.remove("active");
            overlay.classList.remove("active"); // ë°°ê²½ ì›ë˜ëŒ€ë¡œ
        });

        // íŒì—… ì—´ê¸°
        openButton2.addEventListener("click", function () {
            console.log("âœ… íŒì—… ì—´ê¸°");
            popup2.classList.add("active");
            overlay.classList.add("active"); // ë°°ê²½ ì–´ë‘¡ê²Œ ì„¤ì •
        });

        // íŒì—… ë‹«ê¸°
        closeButton2.addEventListener("click", function () {
            console.log("âœ… íŒì—… ë‹«ê¸°");
            popup2.classList.remove("active");
            overlay.classList.remove("active"); // ë°°ê²½ ì›ë˜ëŒ€ë¡œ
        });
        // ë°°ê²½ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
        overlay.addEventListener("click", function () {
            popup.classList.remove("active");
            popup2.classList.remove("active");
            overlay.classList.remove("active"); // ë°°ê²½ ì›ë˜ëŒ€ë¡œ
        });
    });

    // âœ… ë’¤ë¡œ ê°€ê¸° ì‹œ ì„¸ì…˜ ë°ì´í„° ì‚­ì œ
    window.addEventListener("popstate", function () {
        sessionStorage.removeItem("resultMap");
    });

    // âœ… ë‹¤ë¥¸ í˜ì´ì§€ ì´ë™ ì‹œ ì„¸ì…˜ ì‚­ì œ (ìƒˆë¡œê³ ì¹¨ì€ ìœ ì§€)
    window.addEventListener("beforeunload", function (event) {
        // âœ… ìµœì‹  APIë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œê³ ì¹¨ ì—¬ë¶€ ê°ì§€ (ì•ˆì „í•œ ë°©ì‹)
        let navEntries = window.performance.getEntriesByType("navigation");
        let isPageReload = (navEntries.length > 0 && navEntries[0].type === "reload")
            || event.persisted
            || performance.getEntriesByType("navigation")[0]?.type === "reload";

        if (!isPageReload) {
            sessionStorage.removeItem("resultMap"); // âœ… ìƒˆë¡œê³ ì¹¨ì´ ì•„ë‹ ë•Œë§Œ ì‚­ì œ
        }
    });
</script>
</body>
</html>
