<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FACT CHECK</title>
    <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
    <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>


    <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->
    <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>

    <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>

    <script src="/js/common.js?v=1060"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
    <script src="/js/Mobile.js"></script>
    <style>
        .new-fl-ac {

        }

        .sd-select {
            margin-top: 6px;
        }

        .toggle-password {
            position: absolute;
            right: 10px; /* 오른쪽 여백 */
            top: 50%; /* 수직 가운데 정렬 */
            transform: translateY(-50%); /* 가운데 정렬 보정 */
            width: 24px; /* 아이콘 너비 */
            height: 24px; /* 아이콘 높이 */
            background: url('/images/icon/btn-show.svg') no-repeat center;
            background-size: contain; /* 아이콘 크기 조정 */
            cursor: pointer; /* 클릭 가능 표시 */
            z-index: 2; /* 인풋 필드 위에 표시 */
            pointer-events: auto; /* 클릭 가능 */
        }

        .center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn-close {
            display: none !important; /* 강제로 숨김 */
        }
    </style>
</head>

<body>
<div class="mobile-wrapper page-ticket-list"><!-- ★페이지 Class명 -->
    <!-- [모바일] 헤더  -->
    <div class="mobile-layout-header">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <header>
            <div class="left">
                <div class="hd-btn">
                    <a href="javascript:void(0);" onclick="history.back();" title="뒤로가기">
                        <img src="/images/icon/btn-prev.svg" alt="뒤로가기 아이콘">
                    </a>
                </div>
            </div>
            <div class="center">
                <h2>내 정보</h2>
            </div>
            <div class="right">
                <a href="#" title="전체메뉴" class="btn-menu">
                    <img src="/assets_mobile/images/icon/btn-menu.svg" alt="전체메뉴 아이콘">
                </a>
            </div>
        </header>
    </div> <!-- //mobile-layout-header end-->

    <!-- [모바일] 메뉴  -->
    <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>

    <!-- [모바일] 컨덴츠  -->
    <div class="mobile-layout-contents">
        <!--- (레이아웃) Contents 영역 -->
        <div class="layout-contents">
            <!-- 컨텐츠 영역  -->
            <div class="contents-wrap">
                <form id="userForm" autocomplete="off">
                <div class="write-wrap">
                    <dl>
                        <dt>
                            <label for="login_id">
                                ID
                            </label>
                        </dt>
                        <dd>
                            <div class="input-clear">
                                <input type="text" id="login_id" name="login_id" readonly>
                                <input type="hidden" id="id" name="id"/>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label for="name">
                                성명
                            </label>
                        </dt>
                        <dd>
                            <div class="input-clear">
                                <input type="text" id="name" name="name">
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label>
                                변경 비밀번호
                            </label>
                        </dt>
                        <dd>
                            <div class="input-clear">
                                <input type="password" id="PasswordChange" name="PasswordChange" placeholder="비밀번호">
                                <i class="toggle-password" data-target="PasswordChange"></i>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label>
                                비밀번호 확인
                            </label>
                        </dt>
                        <dd>
                            <div class="input-clear">
                                <input type="password" id="PasswordChangeChk" name="PasswordChangeChk" placeholder="비밀번호 확인">
                                <i class="toggle-password" data-target="PasswordChangeChk"></i>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label for="phone">
                                핸드폰
                            </label>
                        </dt>
                        <dd>
                            <input type="text" id="phone" name="phone">
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label for="email">
                                이메일
                            </label>
                        </dt>
                        <dd>
                            <div class="input-clear">
                                <input type="text" id="email" name="email">
                            </div>
                        </dd>
                    </dl>
                </div>
                </form>
            </div> <!--// contents-wrap end-->
            <div class="button-wrap">
                <button class="btn-navy" id="btnSaveAuth" onclick="upUserInfo()">수정</button>
            </div>
        </div> <!--//layout-contents end -->

    </div> <!-- //mobile-layout-contents end-->
</div> <!-- //page-wrapper end-->

<script type="text/javascript">

    $(document).ready(function () {

        UserInfo();

    });

    function UserInfo() {
        let popup = document.getElementById('popup1');
        let wrapper = document.getElementById('wrapper1');

        $.ajax({
            url: '/account/myinfo', // 사용자 정보를 가져올 URL
            type: 'GET',
            dataType: 'json', // 응답 데이터 형식 지정
            success: function (response) {
                // AJAX 호출 성공 시 처리할 로직
                if (response && response.data) {
                    $('#id').val(response.data.id);
                    $('#login_id').val(response.data.login_id); // ID 필드 채우기
                    $('#name').val(response.data.name); // 이름 필드 채우기
                    $('#email').val(response.data.email);
                    $('#phone').val(response.data.phone);
                }
                // console.log('사용자 정보 가져오기 성공: ', response);
            },
            error: function (xhr, status, error) {
                // AJAX 호출 실패 시 처리할 로직
                console.error('사용자 정보 가져오기 실패: ', error);
            }
        });

        // popup.style.display = 'block';
        // wrapper.style.display = 'block';
    }

    function upUserInfo() {
        const id = $('#id').val();
        const loginId = $('#login_id').val();
        const name = $('#name').val();
        const password = $('#PasswordChange').val();
        const passwordChk = $('#PasswordChangeChk').val();
        const phone = $('#phone').val();
        const email = $('#email').val();

        // 비밀번호 확인 로직 추가
        if (password !== passwordChk) {
            Alert.alert('', '비밀번호가 일치하지 않습니다.');
            return;
        }

        if (!loginId || !name || !phone || !email) {
            Alert.alert('', '모든 필수 항목을 입력해주세요.');
            return;
        }

        $.ajax({
            url: '/account/userInfo/update', // 사용자 정보 업데이트 URL
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                id:id,
                login_id: loginId,
                name: name,
                password: password,
                phone: phone,
                email: email
            }),
            headers: {
                'X-CSRF-Token': $('[name=_csrf]').val() // CSRF 토큰 추가
            },
            success: function (response) {
                if (response.success) {
                    Alert.alert('', '사용자 정보가 성공적으로 수정되었습니다.');
                    UserInfo();
                } else {
                    Alert.alert('', '수정 중 문제가 발생했습니다: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                console.error('사용자 정보 수정 실패: ', error);
                Alert.alert('', '사용자 정보 수정 요청 중 오류가 발생했습니다.');
            }
        });
    }

    document.querySelectorAll('.toggle-password').forEach(icon => {
        icon.addEventListener('click', () => {
            const targetId = icon.getAttribute('data-target');
            const inputField = document.getElementById(targetId);

            if (inputField.type === 'password') {
                inputField.type = 'text';
                icon.style.backgroundImage = "url('/images/icon/btn-hidden.svg')"; // 비밀번호 보임 상태
            } else {
                inputField.type = 'password';
                icon.style.backgroundImage = "url('/images/icon/btn-show.svg')"; // 비밀번호 숨김 상태
            }
        });
    });
</script>
</body>
</html>
