<!DOCTYPE html>
<html lang="ko">
<style>
    .btn-clear {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }

    .btn-close {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .toggle-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: 0.3s;
    }

    .list-border {
        border-bottom: 1px solid #ccc;
        margin-top: 5px;
        width: 100%;
    }

    /* ë¦¬ìŠ¤íŠ¸ ë°•ìŠ¤ (ì•„ì´ì½˜ ë·° - ê¸°ë³¸ê°’) */
    .list-box {

    }

    /* ì•„ì´ì½˜ ë·° (í•œ ì¤„ì— 3ê°œ) */
    .list-box.icon-view {
        justify-content: left;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding-top: 10px;
        max-height: 73vh;
        overflow-y: auto;
        scrollbar-gutter: stable; /* âœ… ìŠ¤í¬ë¡¤ë°” ê³µê°„ì„ í™•ë³´í•˜ì—¬ ë°€ë¦¬ì§€ ì•Šë„ë¡ í•¨ */
        margin-right: -15px;
    }

    .list-box.icon-view .list-item {
        width: calc(33.33% - 10px); /* 3ê°œì”© ë°°ì¹˜ */
    }

    /* ë¦¬ìŠ¤íŠ¸ ë·° (í•œ ì¤„ì— 1ê°œ) */
    .list-box.list-view {
        display: flex;
        flex-direction: column;
        max-height: 73vh;
        overflow-x: auto;
        scrollbar-gutter: stable; /* âœ… ìŠ¤í¬ë¡¤ë°” ê³µê°„ì„ í™•ë³´í•˜ì—¬ ë°€ë¦¬ì§€ ì•Šë„ë¡ í•¨ */
        margin-right: -15px;
        padding-right: 10px;
    }

    .list-box.list-view .list-item {
        width: 100%;
        display: flex;
        align-items: center;
    }

    .region-wrap {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 5%;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .region-wrap button {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
    }

    .number-box {
        display: flex; /* âœ… Flexbox ì ìš© */
        align-items: center; /* âœ… ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: center; /* âœ… ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */

        width: 100px;
        height: 95px;

        font-size: 50px; /* ìˆ«ì í¬ê¸° */
        font-weight: 900; /* ìµœëŒ€ êµµê¸° */
        background: #f8f8f8;
        -webkit-text-stroke: 2px black; /* ê¸€ì í…Œë‘ë¦¬ (ê²€ì€ìƒ‰) */
        padding: 15px;
        border-radius: 10px;
        text-align: center; /* âœ… í…ìŠ¤íŠ¸ ê°€ë¡œ ì •ë ¬ */
    }


</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FACT CHECK</title>
    <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
    <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->

    <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>

    <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>

    <script src="/js/common.js?v=1060"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
    <script src="/js/Mobile.js"></script>
    <link rel="stylesheet" href="/css/MapCss/region.css">
</head>
<div class="mobile-wrapper"><!-- â˜…í˜ì´ì§€ Classëª… -->
    <!-- [ëª¨ë°”ì¼] í—¤ë”  -->
    <div class="mobile-layout-header">
        <header>
            <div class="left">
                <a href="#" title="ì „ì²´ë©”ë‰´" class="logo">
                </a>
            </div>
            <div class="center" style="margin-left:10px;">
                <h2>ì¹´ë“œë¡œ ë³´ê¸°</h2>
            </div>
            <div class="right">
                <a href="#" title="ì „ì²´ë©”ë‰´" class="btn-menu">
                    <img src="/assets_mobile/images/icon/btn-menu.svg" alt="ì „ì²´ë©”ë‰´ ì•„ì´ì½˜">
                </a>
            </div>
        </header>
    </div> <!-- //mobile-layout-header end-->

    <!-- [ëª¨ë°”ì¼] ë©”ë‰´  -->
    <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>
    <!-- [ëª¨ë°”ì¼] ì»¨ë´ì¸   -->
    <div class="mobile-layout-contents">
        <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
        <div class="layout-contents" style="width:100%;">
            <!-- ì»¨í…ì¸  ì˜ì—­  -->
            <div class="contents-wrap">
                <div>
                    <li style="margin-top: 5% ">
                        <a href="#" class="btn btn-popup-open" data-popup="popup1" onclick="regionList()"
                           title="ì§€ì—­ì„ íƒ">ì§€ì—­ ì„ íƒ</a>
                    </li>
                </div>
                <div class="region-wrap">
                    <div>
                        <span id="selected-region" style="font-size: 20px; font-weight: bold; color: #333;"></span>

                        <!-- ì´ ê°œìˆ˜ & í‰ê·  ì ìˆ˜ í‘œì‹œ ì˜ì—­ -->
                        <span id="region-stats" style="font-size: 14px; color: #555; display: none;">
                            (<span id="total-count">0</span>ê±´ / í‰ì  <span id="avg-score">0</span>)
                        </span>
                    </div>
                    <!-- ë¦¬ìŠ¤íŠ¸/ì•„ì´ì½˜ ì „í™˜ ë²„íŠ¼ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
                    <div id="view-toggle-buttons" style="display: none; gap: 10px;">
                        <button id="toggle-list" onclick="toggleView()" title="ë¦¬ìŠ¤íŠ¸ í˜•ì‹" class="toggle-btn active">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="gray">
                                <rect x="7" y="4" width="13" height="4" rx="1" fill="currentColor"/>
                                <rect x="7" y="10" width="13" height="4" rx="1" fill="currentColor"/>
                                <rect x="7" y="16" width="13" height="4" rx="1" fill="currentColor"/>
                                <rect x="1" y="4" width="4" height="4" rx="1" fill="currentColor"/>
                                <rect x="1" y="10" width="4" height="4" rx="1" fill="currentColor"/>
                                <rect x="1" y="16" width="4" height="4" rx="1" fill="currentColor"/>
                            </svg>
                        </button>
                        <button id="toggle-grid" onclick="toggleView()" title="ì•„ì´ì½˜ í˜•ì‹" class="toggle-btn"
                                style="display: none;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="gray">
                                <rect x="4" y="4" width="7" height="7" rx="1" fill="currentColor"/>
                                <rect x="13" y="4" width="7" height="7" rx="1" fill="currentColor"/>
                                <rect x="4" y="13" width="7" height="7" rx="1" fill="currentColor"/>
                                <rect x="13" y="13" width="7" height="7" rx="1" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- ë¦¬ìŠ¤íŠ¸ ë°•ìŠ¤ -->
                <div class="list-box icon-view"></div>

            </div>  <!--// contents-wrap end-->
        </div> <!--//layout-contents end -->
    </div> <!-- //mobile-layout-contents end-->

    <div class="mobile-layout-popup">
        <div class="popup-overlay"></div>
        <div class="popup-wrapper" id="popup1">
            <form id="bomForm1">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="popup-title">
                    <h3>ì§€ì—­ ì„ íƒ</h3>
                    <a onclick="RegisterUserClose()" title="íŒì—…ë‹«ê¸°" class="btn-popup-close">
                        <img src="/assets_mobile/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°">
                    </a>
                </div>
                <div class="popup-contents">
                    <div class="table-wrap" id="bomForm">
                        <div class="write-wrap">
                            <div class="row">
                                <dl>
                                    <dt>
                                    </dt>
                                    <dd>
                                        <div id="region-modal" style="display: none;">
                                            <div id="region-SelectList"
                                                 style="font-size: 24px; margin-bottom:25px; "></div>
                                            <div id="region-list"></div>
                                        </div>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="popup-button">
                    <button type="button" class="btn-navy" id="btnSaveAuth" onclick="moveToSelectedRegion()">ì§€ì—­ ê²€ìƒ‰
                    </button>
                </div>
            </form>
        </div>
    </div> <!-- //mobile-layout-popup end -->

    <div class="mobile-layout-popup" >

        <div class="popup-wrapper" id="popup-own">
            <div class="popup-title">
                <h3>ìƒì„¸ ë‚´ì—­</h3>
                <a title="íŒì—…ë‹«ê¸°" class="btn-popup-close">
                    <img src="/assets_mobile/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°">
                </a>
            </div>
            <div class="popup-contents">
                <div class="ticket-tit">
                    <dl>
                        <dt>ì£¼ì†Œ</dt>
                        <dd></dd>
                    </dl>
                </div>
                <div class="list-card-wrap">

                </div>
                <div class="write-wrap">

                </div>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close btn-navy">í™•ì¸</button>
            </div>
        </div>
    </div>


</div> <!-- //page-wrapper end-->
<body>
<script type="text/javascript">
    document.readyState === 'complete' ? init() : window.onload = init;

    let selectedPath = {
        city: '',  // ì„ íƒí•œ ì‹œ/ë„
        district: '', // ì„ íƒí•œ êµ¬
        // neighborhood: '' // ì„ íƒí•œ ë™
    };

    let selectedTempPath = {
        city: '',  // ì„ì‹œ ì„ íƒëœ ì‹œ/ë„
        district: '', // ì„ì‹œ ì„ íƒëœ êµ¬
        // neighborhood: '' // ì„ì‹œ ì„ íƒëœ ë™
    };

    function init() {
        regionList();
    }

    //ì§€ì—­ì„ íƒ íŒì—…ì—´ê¸°
    function regionList() {
        let popup = document.getElementById('popup1');
        let overlay = document.querySelector('.popup-overlay');

        if (popup && overlay) {
            popup.classList.add('active'); // íŒì—… í™œì„±í™”
            overlay.style.display = 'block'; // ì˜¤ë²„ë ˆì´ ë³´ì´ê¸°
        } else {
            console.error('popup1 ë˜ëŠ” popup-overlay ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        fetchRegionDataAjax();
    }

    function RegisterUserClose() {
        let popup = document.getElementById('popup1');
        let overlay = document.querySelector('.popup-overlay');

        if (popup && overlay) {
            // íŒì—… ë¹„í™œì„±í™”
            popup.classList.remove('active');

            // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
            overlay.style.display = 'none';
            $('#region-SelectList').empty(); // ì„ íƒí•œ ê²½ë¡œ ì´ˆê¸°í™”

            selectedTempPath = {city: '', district: '', neighborhood: ''}; // ì„ íƒ ê²½ë¡œ ì´ˆê¸°í™”
            // ì…ë ¥ í¼ ì´ˆê¸°í™”
        } else {
            console.error('popup1 ë˜ëŠ” popup-overlay ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
    }

    //ëª¨ë‹¬ ë###############################################

    // localStorageì—ì„œ ê¸°ì¡´ ì €ì¥ëœ ì§€ì—­ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´)
    var loadedRegions = new Set(JSON.parse(localStorage.getItem('loadedRegions')) || []);

    //ì§€ì—­ ë¶ˆëŸ¬ì˜¤ê¸° ###########
    // SGIS API ë°ì´í„° ìš”ì²­
    function fetchRegionDataAjax() {
        $.ajax({
            url: '/api/Map', // SGIS API ì—”ë“œí¬ì¸íŠ¸
            type: 'GET',
            async: false,
            headers: {
                'X-CSRF-Token': $('[name=_csrf]').val()
            },
            success: function (data) {
                if (data.success) {
                    populateRegionListAjax(data);
                } else {
                    console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", data.message);
                }
            },
            error: function (xhr, status, error) {
                console.error("API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        });
    }

    // ì§€ì—­ ëª©ë¡ ìƒì„±
    function populateRegionListAjax(data) {
        const regionList = $('#region-list');
        regionList.empty(); // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        // ì´ë¯¸ JSON ê°ì²´ë¼ë©´ JSON.parseë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
        const results = data.data.result; // JSON ë°ì´í„° ì ‘ê·¼
        results.forEach(region => {
            const button = $('<button></button>')
                .text(region.addr_name) // ì‹œ/ë„ ì´ë¦„ ì„¤ì •
                .attr('class', 'region-button') // ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤
                .attr('type', 'button')
                .on('click', () => loadDistrictsAjax(region.cd, region.addr_name)); // ì´ë¦„ê³¼ ì½”ë“œ ì „ë‹¬
            regionList.append(button); // ë²„íŠ¼ ì¶”ê°€
        });

        $('#region-modal').show(); // ëª¨ë‹¬ ë³´ì´ê¸°
    }

    // ì‹œ/ë„ ì„ íƒ ì‹œ êµ¬ ëª©ë¡ ë¡œë“œ
    function loadDistrictsAjax(cityCode, cityName) {
        selectedTempPath = {city: '', district: '', neighborhood: ''}; // ì„ íƒ ê²½ë¡œ ì´ˆê¸°í™”
        selectedPath = {city: '', district: '', neighborhood: ''}; // ì„ íƒ ê²½ë¡œ ì´ˆê¸°í™”
        selectedTempPath.city = cityName; // ì‹œ/ë„ ì´ë¦„ ì €ì¥
        updateSelectedPath(); // ì„ íƒ ê²½ë¡œ ì—…ë°ì´íŠ¸

        $.ajax({
            url: '/api/Map',
            type: 'GET',
            data: {cd: cityCode},
            headers: {
                'X-CSRF-Token': $('[name=_csrf]').val()
            },
            success: function (data) {
                const regionList = $('#region-list');
                regionList.empty();

                if (data.success) {
                    // JSON ê°ì²´ë¡œ ë°”ë¡œ ì ‘ê·¼
                    const results = data.data.result;
                    results.forEach(district => {
                        const button = $('<button></button>')
                            .text(district.addr_name)
                            .attr('class', 'district-button')
                            .attr('type', 'button')
                            .on('click', () => loadNeighborhoodsAjax(district.cd, district.addr_name));
                        regionList.append(button);
                    });
                } else {
                    console.error("êµ¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", data.message);
                }
            },
            error: function (xhr, status, error) {
                console.error("API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        });
    }

    // êµ¬ ì„ íƒ ì‹œ ë™ ëª©ë¡ ë¡œë“œ
    function loadNeighborhoodsAjax(districtCode, districtName) {
        selectedTempPath.district = districtName; // êµ¬ ì´ë¦„ ì €ì¥
        updateSelectedPath(); // ì„ íƒ ê²½ë¡œ ì—…ë°ì´íŠ¸

        // $.ajax({
        //     url: '/api/Map',
        //     type: 'GET',
        //     data: {cd: districtCode},
        //     headers: {
        //         'X-CSRF-Token': $('[name=_csrf]').val()
        //     },
        //     success: function (data) {
        //         const regionList = $('#region-list');
        //         regionList.empty();
        //
        //         if (data.success) {
        //             const results = data.data.result;
        //             results.forEach(neighborhood => {
        //                 const button = $('<button></button>')
        //                     .text(neighborhood.addr_name)
        //                     .attr('class', 'neighborhood-button')
        //                     .attr('type', 'button')
        //                     .on('click', () => selectNeighborhood(neighborhood.addr_name));
        //                 regionList.append(button);
        //             });
        //         } else {
        //             console.error("ë™ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", data.message);
        //         }
        //     },
        //     error: function (xhr, status, error) {
        //         console.error("API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        //     }
        // });
    }

    // ë™ ì„ íƒ ì‹œ ìµœì¢… ê²½ë¡œ ì—…ë°ì´íŠ¸
    // function selectNeighborhood(neighborhoodName) {
    //     selectedTempPath.neighborhood = neighborhoodName; // ë™ ì´ë¦„ ì €ì¥
    //     updateSelectedPath(); // ì„ íƒ ê²½ë¡œ ì—…ë°ì´íŠ¸
    //
    // }

    // ì„ íƒ ê²½ë¡œ (ì„ì‹œ) ì—…ë°ì´íŠ¸
    function updateTempSelectedPath() {
        const fullPath = selectedTempPath.district
            ? `${selectedTempPath.city} ${selectedTempPath.district}`.trim()
            : selectedTempPath.city.trim();

        const selectedRegionElement = document.getElementById('selected-region');
        const toggleButtons = document.getElementById("view-toggle-buttons");

        if (selectedRegionElement) {
            selectedRegionElement.textContent = fullPath || "ì§€ì—­ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
            toggleButtons.style.display = "flex";
        } else {
            console.error("ì„ íƒëœ ì§€ì—­ì„ í‘œì‹œí•  ìš”ì†Œ(selected-region)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            toggleButtons.style.display = "none";
        }
    }

    // ì„ íƒ ê²½ë¡œ ì—…ë°ì´íŠ¸
    function updateSelectedPath() {
        const fullPath = selectedTempPath.district
            ? `${selectedTempPath.city} ${selectedTempPath.district}`.trim()
            : selectedTempPath.city.trim();

        const selectedRegionElement2 = document.getElementById('region-SelectList');

        if (selectedRegionElement2) {
            selectedRegionElement2.textContent = fullPath || "ì§€ì—­ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
        } else {
            console.error("ì„ íƒëœ ì§€ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }


    function moveToSelectedRegion() {

        // if (!selectedTempPath.city || !selectedTempPath.district || !selectedTempPath.neighborhood) {
        //     Alert.alert('', "ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
        //     return;
        // }
        if (!selectedTempPath.city) {
            Alert.alert('', "ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        const requestData = {
            resido: selectedTempPath.city,
            regugun: selectedTempPath.district || null // êµ¬/êµ°ì´ ì—†ìœ¼ë©´ `null`
        };

        $.ajax({
            url: "/api/Map/getList",
            type: "GET",
            data: requestData,
            headers: {
                'X-CSRF-Token': $('[name=_csrf]').val()
            },
            success: function (response) {
                if (response.success) {

                    // total_count & avg_score ì—…ë°ì´íŠ¸
                    $("#total-count").text(response.data.length > 0 ? response.data[0].total_count : 0);
                    $("#avg-score").text(response.data.length > 0 ? parseFloat(response.data[0].avg_score).toFixed(1) : 0);

                    // ì •ë³´ í‘œì‹œ í™œì„±í™”
                    $("#region-stats").show();

                    // ë¦¬ìŠ¤íŠ¸ë°•ìŠ¤ ì´ˆê¸°í™”
                    $('.list-box').empty();

                    const isListView = document.querySelector(".list-box").classList.contains("list-view");

                    // ì‘ë‹µ ë°ì´í„° ìˆœíšŒí•˜ë©´ì„œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
                    for (let i = 0; i < response.data.length; i++) {
                        let realScore = response.data[i].REALSCORE;
                        const realAdd = response.data[i].SHORT_ADDR;
                        const itemData = response.data[i];

                        // ğŸ”¥ null ì²˜ë¦¬
                        if (realScore === null) {
                            realScore = "?";
                        }

                        // ğŸ”¥ ì ìˆ˜ ë²”ìœ„ì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
                        let scoreColor = "#000000"; // ê¸°ë³¸ í°ìƒ‰
                        if (!isNaN(realScore)) {
                            realScore = parseInt(realScore); // ìˆ«ìë¡œ ë³€í™˜
                            if (realScore >= 90) scoreColor = "#FFFFFF"; // í°ìƒ‰
                            else if (realScore >= 80) scoreColor = "#00FF00"; // ì´ˆë¡ìƒ‰
                            else if (realScore >= 70) scoreColor = "#0000FF"; // íŒŒë€ìƒ‰
                            else if (realScore >= 60) scoreColor = "#FFFF00"; // ë…¸ë€ìƒ‰
                            else if (realScore >= 50) scoreColor = "#FFA500"; // ì£¼í™©ìƒ‰
                            else if (realScore >= 40) scoreColor = "#FF0000"; // ë¹¨ê°„ìƒ‰
                            else scoreColor = "#000000"; // ê²€ì •ìƒ‰
                        }


                        // ë°•ìŠ¤ ìƒì„± ë° ë‚´ìš© ì¶”ê°€
                        const box = $('<div></div>')
                            .addClass('list-item')
                            .append(
                                $('<div></div>')
                                    .addClass('number-box')
                                    .text(realScore) // ì ìˆ˜ ë˜ëŠ” '?'
                                    .css({
                                        "color": scoreColor
                                    })
                            )
                            .append($('<div style="margin: 5px;"></div>').text(realAdd))
                            .on("click", function () {
                                handleListItemClick(itemData); // ğŸ”¥ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
                            });

                        // ë¦¬ìŠ¤íŠ¸ë°•ìŠ¤ì— ì¶”ê°€
                        $('.list-box').append(box);

                        if (isListView) {
                            const borderDiv = $("<div></div>")
                                .addClass("list-border")
                                .css({
                                    "border-bottom": "1px solid #ccc",
                                    "margin": "15px 0",
                                    "width": "100%"
                                });
                            $('.list-box').append(borderDiv);
                        }
                    }

                    // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ì´ˆê¸°í™”
                    $('.list-box').scrollTop(0);

                    // ìµœì¢… ê°’ ì—…ë°ì´íŠ¸
                    selectedPath = {...selectedTempPath};
                    updateTempSelectedPath();
                    updateSelectedPath();
                    RegisterUserClose(); // ì§€ì—­ì„ íƒì‹œ ëª¨ë‹¬ë‹«ê¸°
                } else {
                    RegisterUserClose();
                    Alert.alert("","í•´ë‹¹ ì§€ì—­ì˜ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");

                }
            },
            error: function (xhr, status, error) {
                // ì—ëŸ¬ ì²˜ë¦¬
                Alert.alert("","ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }

    function handleListItemClick(item){

        let realid = item.REALID;
        // console.log('realid', realid);
        $.ajax({
            url: "/api/Map/getOwn",
            type: "GET",
            data: { realid: realid}, // realid ë¡œ ë°”ê¾¸ë©´ ë¨
            headers: {
                'X-CSRF-Token': $('[name=_csrf]').val()
            },
            success: function (response) {
                if (response.success) {
                    // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ì´ˆê¸°í™”

                    updatePopupContent(response.dataA, response.dataB, item);
                    $('.list-card-wrap').scrollTop(0);

                } else {
                    Alert.alert("", "í•´ë‹¹ ë¬¼ê±´ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

                }
            },
            error: function (xhr, status, error) {
                // ì—ëŸ¬ ì²˜ë¦¬
                Alert.alert("", "ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });

    }

    function updatePopupContent(dataA, dataB, listData) {
        let popup = document.getElementById('popup-own');
        let overlay = document.querySelector('.popup-overlay');
        let listContainer = document.querySelector('.list-card-wrap');
        let addressField = document.querySelector('#popup-own .ticket-tit dd');

        // ì£¼ì†Œ ì—…ë°ì´íŠ¸ (null ë˜ëŠ” undefinedì¼ ê²½ìš° ë¹ˆ ë¬¸ìì—´)
        addressField.textContent = listData?.SHORT_ADDR ?? 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ';

        // íŒì—… ì´ˆê¸°í™”
        listContainer.innerHTML = '';

        let allData = [];

        // A ë°ì´í„° ì¶”ê°€
        if (dataA && dataA.length > 0) {
            dataA.forEach(item => {
                allData.push({ ...item, type: 'A' });
            });
        }

        // B ë°ì´í„° ì¶”ê°€
        if (dataB && dataB.length > 0) {
            dataB.forEach(item => {
                allData.push({ ...item, type: 'B' });
            });
        }

        // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°
        if (allData.length === 0) {
            listContainer.innerHTML = '<p style="text-align: center; padding: 10px;">í•´ë‹¹ ë¬¼ê±´ì˜ ë“±ê¸°ë¶€ë“±ë³¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
            allData.forEach(item => {
                let formatValue = (value) => {
                    return value === null || value === undefined || value.toString().trim().toLowerCase() === "null"
                        ? '' // ë¹ˆì¹¸ ì²˜ë¦¬
                        : value;
                };

                // Aì™€ Bë¥¼ êµ¬ë¶„í•˜ì—¬ ì¹´ë“œ ìƒ‰ìƒ ë° êµ¬ë¶„ ëª…ì¹­ ì ìš©
                let cardClass = item.type === 'A' ? 'card-red' : 'card-blue';
                let statusClass = item.type === 'A' ? 'sta-red' : 'sta-blue';
                let sectionName = item.type === 'A' ? 'ê°‘êµ¬' : 'ì„êµ¬'; // AëŠ” 'ê°‘êµ¬', BëŠ” 'ì„êµ¬'

                let cardHtml = `
                <div class="card-box ${cardClass}">
                    <div class="card-cont">
                        <dl>
                            <dt>êµ¬ë¶„</dt>
                            <dd><span class="${statusClass}">${sectionName}</span></dd>
                        </dl>
                        <dl>
                            <dt>ìˆœìœ„ ë²ˆí˜¸</dt>
                            <dd>${formatValue(item?.RankNo)}</dd>
                        </dl>
                        <dl>
                            <dt>ë“±ê¸°ëª©ì </dt>
                            <dd>${formatValue(item?.RgsAimCont)}</dd>
                        </dl>
                        <dl>
                            <dt>ì ‘ìˆ˜</dt>
                            <dd>${formatValue(item?.Receve)}</dd>
                        </dl>
                        <dl>
                            <dt>ë“±ê¸°ì›ì¸</dt>
                            <dd>${formatValue(item?.RgsCaus)}</dd>
                        </dl>
                        <dl>
                            <dt colspan="2" style="width: 100%;text-align: left;">ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­</dt>
                        </dl>
                        <dl>
                            <dd colspan="2" style="width: 100%;text-align: left;">${formatValue(item?.NomprsAndEtc)}</dd>
                        </dl>
                    </div>
                </div>
            `;

                // ìƒì„±ëœ ì¹´ë“œ ì¶”ê°€
                listContainer.innerHTML += cardHtml;
            });
        }

        // íŒì—… í™œì„±í™”
        if (popup && overlay) {
            popup.classList.add('active');
            overlay.style.display = 'block';
        } else {
            console.error('popup-own ë˜ëŠ” popup-overlay ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ìŠ¤í¬ë¡¤ ì´ˆê¸°í™” (íŒì—…ì´ ê¸¸ì–´ì§ˆ ê²½ìš°)
        popup.scrollTop = 0;
    }



    function toggleView() {
        const listBox = document.querySelector(".list-box");
        const listButton = document.getElementById("toggle-list");
        const gridButton = document.getElementById("toggle-grid");

        if (listBox.classList.contains("icon-view")) {
            // ë¦¬ìŠ¤íŠ¸ ë·°ë¡œ ë³€ê²½
            listBox.classList.remove("icon-view");
            listBox.classList.add("list-view");

            // ë²„íŠ¼ ì•„ì´ì½˜ ë³€ê²½
            listButton.style.display = "none";
            gridButton.style.display = "inline-flex";

            // í™œì„±í™” ìƒíƒœ ë³€ê²½
            listButton.classList.remove("active");
            gridButton.classList.add("active");

            // ë¦¬ìŠ¤íŠ¸ ë·°ì¼ ë•Œ ê° list-item ì•„ë˜ list-border ì¶”ê°€ (list-itemê³¼ ë™ê¸‰)
            document.querySelectorAll('.list-item').forEach(item => {
                if (!item.nextElementSibling || !item.nextElementSibling.classList.contains("list-border")) {
                    const borderDiv = document.createElement("div");
                    borderDiv.classList.add("list-border");
                    borderDiv.style.borderBottom = "1px solid #ccc";
                    borderDiv.style.margin = "15px 0";
                    borderDiv.style.width = "100%";
                    listBox.insertBefore(borderDiv, item.nextSibling);
                }
            });

        } else {
            // ì•„ì´ì½˜ ë·°ë¡œ ë³€ê²½
            listBox.classList.remove("list-view");
            listBox.classList.add("icon-view");

            // ë²„íŠ¼ ì•„ì´ì½˜ ë³€ê²½
            listButton.style.display = "inline-flex";
            gridButton.style.display = "none";

            // í™œì„±í™” ìƒíƒœ ë³€ê²½
            listButton.classList.add("active");
            gridButton.classList.remove("active");

            // ì•„ì´ì½˜ ë·°ì¼ ë•Œ list-border ì œê±°
            document.querySelectorAll('.list-border').forEach(border => {
                border.remove();
            });
        }
    }

    $('.btn-popup-close').on('click', function() {
        $('.popup-overlay').fadeOut(200);
        $('.popup-wrapper').removeClass('active');
    });


</script>
</body>
</html>