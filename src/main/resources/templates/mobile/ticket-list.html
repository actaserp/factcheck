<!DOCTYPE html>
<html lang="ko">
<style>
    .btn-clear {
        display: none !important; /* Í∞ïÏ†úÎ°ú Ïà®ÍπÄ */
    }

    .btn-close {
        display: none !important; /* Í∞ïÏ†úÎ°ú Ïà®ÍπÄ */
    }


    .tab-item {
        display: none; /* Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Î™®Îì† ÌÉ≠ ÎÇ¥Ïö©ÏùÑ Ïà®ÍπÅÎãàÎã§ */
    }

    .tab-item.active {
        display: block; /* 'active' ÌÅ¥ÎûòÏä§Í∞Ä ÏûàÏùÑ ÎïåÎßå Ìï¥Îãπ ÌÉ≠ ÎÇ¥Ïö©ÏùÑ ÌëúÏãú */
    }


    .tab-links {
        display: flex;
        margin-left: 1px;
        margin-bottom: -1px;
        overflow: hidden;
    }

    .tab-links li {
        position: relative;
    }

    .tab-links li:first-child a {
        border-radius: 6px 0 0 0;
    }

    .tab-links li:last-child a {
        border-radius: 0 6px 0 0;
    }

    .tab-links li a {
        display: inline-flex;
        justify-content: center;
        min-width: 120px;
        padding: 3px 32px 15px 32px;
        color: #808080;
        font-size: 18px;
        font-weight: 700;
        text-align: center;
        transition: all .3s;
        border-bottom: 3px solid #C6C6C6;
    }

    .tab-links li:hover a {
        color: #4D4D4D;
        font-weight: 700;
        border-bottom: 3px solid #4D4D4D;
    }

    .tab-links li.active a {
        color: #03428E;
        font-weight: 700;
        border-bottom: 3px solid #03428E;
    }

    section .tab-links {
    }

    section .tab-links li a {
        padding: 8px 10px;
        margin-right: -1px;
        border: 1px solid #E4E4E4;
        background-color: #fff;
        color: #808080;
    }

    section .tab-links li:first-child a {
        border-radius: 12px 0 0 12px;
    }

    section .tab-links li:last-child a {
        border-radius: 0 12px 12px 0;
        margin-right: 0;
    }

    section .tab-links li.active a {
        background-color: #3069B3;
        color: #fff;
    }

    .tab-links-sub {
        display: flex;
        margin-left: 1px;
        margin-bottom: -1px;
        overflow: hidden;
    }

    .tab-links-sub li {
        position: relative;
    }

    .tab-links-sub li a {
        display: inline-flex;
        border: 1px solid #E4E4E4;
        justify-content: center;
        min-width: 90px;
        padding: 8px 32px 8px 32px;
        background-color: #fff;
        color: #333333;
        font-size: 17px;
        font-weight: 700;
        text-align: center;
        transition: all .3s;
    }

    .tab-links-sub li:hover a {
        border-radius: 3px 0 0 3px;
        color: #4D4D4D;
        border: 1px solid #E4E4E4;
        border-right: 1px solid #E4E4E4;
        border-left: 1px solid #E4E4E4;
        background-color: #f5f6fa;
    }

    .tab-links-sub li:first-child a {
        border-radius: 3px 0 0 3px;
        border-right: 0
    }

    .tab-links-sub li:first-child:hover a {
        border-radius: 3px 0 0 3px;
        color: #4D4D4D;
        border: 1px solid #b3b3b3;
        border-right: 0;
        background-color: #f5f6fa;
    }

    .tab-links-sub li:last-child a {
        border-radius: 0 3px 3px 0;
        border-left: 0
    }

    .tab-links-sub li:last-child:hover a {
        color: #4D4D4D;
        border: 1px solid #b3b3b3;
        border-left: 0;
        background-color: #f5f6fa;
        border-radius: 0 3px 3px 0;
        border-left: 0
    }

    /*section .tab-links-sub li:hover a {color: #4D4D4D; border: 1px solid #b3b3b3; background-color: #f5f6fa;}*/
    .tab-links-sub li.active a {
        background-color: #2EC9D6;
        color: #fff;
        font-weight: 700;
        border: 1px solid #2EC9D6;
    }

    /*section .tab-links-sub {}*/
    /*section .tab-links-sub li a {padding: 8px 10px; margin-right: -1px; border: 1px solid #E4E4E4; background-color: #fff; color: #333333;}*/
    /*section .tab-links-sub li:hover a {color: #4D4D4D; border: 1px solid #b3b3b3; background-color: #f5f6fa;}*/
    /*section .tab-links-sub li:first-child a {border-radius: 3px 0 0 3px;}*/
    /*section .tab-links-sub li:last-child a {border-radius: 0 3px 3px 0; margin-right: 0;}*/
    /*section .tab-links-sub li.active a {background-color: #2EC9D6; color: #fff;}*/
    .tab-contents > section, .tab-item1 > .row > section:first-child {
        border-radius: 0 15px 15px 15px;
    }

    .tab-contents > .row > section {
        border-radius: 0 15px 15px 15px;
    }

    .tab-item-sub {
        display: none;
        transition: all .3s;
    }

    .tab-item-sub.active {
        display: block;
    }

</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FACT CHECK</title>
    <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
    <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->
    <script th:inline="javascript">
        var sandanData = /*[[${session.sandanList}]]*/ [];
    </script>


    <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>

    <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>

    <script src="/js/common.js?v=1060"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
    <script src="/js/Mobile.js"></script>
</head>

<body>
<div class="mobile-wrapper page-ticket-list"><!-- ‚òÖÌéòÏù¥ÏßÄ ClassÎ™Ö -->
    <!-- [Î™®Î∞îÏùº] Ìó§Îçî  -->
    <div class="mobile-layout-header">
        <header>
            <div class="left">
                <a href="#" title="Ï†ÑÏ≤¥Î©îÎâ¥" class="logo">
                </a>
            </div>
            <div class="center" style="margin-left:35px;">
                <h2>Î¨ºÍ±¥ Ïó¥Îûå ÏÉÅÏÑ∏ ÎÇ¥Ïó≠</h2>
            </div>
            <div class="right">
                <a href="#" title="Ï†ÑÏ≤¥Î©îÎâ¥" class="btn-menu">
                    <img src="/assets_mobile/images/icon/btn-menu.svg" alt="Ï†ÑÏ≤¥Î©îÎâ¥ ÏïÑÏù¥ÏΩò">
                </a>
            </div>
        </header>
    </div> <!-- //mobile-layout-header end-->

    <!-- [Î™®Î∞îÏùº] Î©îÎâ¥  -->
    <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>
    <!-- [Î™®Î∞îÏùº] Ïª®Îç¥Ï∏†  -->
    <div class="mobile-layout-contents">
        <!--- (Î†àÏù¥ÏïÑÏõÉ) Contents ÏòÅÏó≠ -->
        <div class="layout-contents">
            <!-- Í≤ÄÏÉâ ÏòÅÏó≠  -->
            <div class="search-wrap">
                <div class="srch-tit aco-hd">
                    <p>ÌöåÏõêÎì§Ïù¥ Ï°∞ÌöåÌïú Îì±Í∏∞Î∂Ä Ï†ïÎ≥¥Î•º Î≥ºÏàòÏûàÏäµÎãàÎã§.</p>
                    <a href="#" title="Ïó¥Í∏∞/Îã´Í∏∞" class="btn-aco">
                        <img src="/assets_mobile/images/icon/ico-down.svg" alt="Ïó¥Í∏∞/Îã´Í∏∞">
                    </a>
                </div>
                <div class="srch-cont aco-cont">
                    <dl>
                        <dt>
                            Ï°∞ÌöåÏùºÏûê<span class="eq">*</span>
                        </dt>
                        <dd>
                            <ul class="date-box">
                                <li>
                                    <input type="date" id="startDate" name="startDate">
                                    <label for="startDate" class="hide">ÏãúÏûëÏùº</label>
                                </li>
                                <li>
                                    <input type="date" id="endDate" name="endDate">
                                    <label for="endDate" class="hide">Ï¢ÖÎ£åÏùº</label>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                    <dl>
                        <dt>Í≤ÄÏÉâÏ°∞Í±¥</dt>
                        <dd>
                            <div style="width: 100%; display: flex; gap: 20px;">
                                <label for="property" style="display: flex; align-items: center; gap: 5px;"></label>
                                <select id="property" name="property" style="width: 100%; text-align: center;">
                                    <option value="my_property" selected>ÎÇ¥Í∞Ä Ï°∞ÌöåÌïú Î¨ºÍ±¥</option>
                                    <option value="recent_property">ÏµúÍ∑º Ï°∞ÌöåÌïú Î¨ºÍ±¥</option>
                                    <option value="most_viewed_property">Í∞ÄÏû• ÎßéÏù¥ Î∞úÍ∏âÎ∞õÏùÄ Î¨ºÍ±¥</option>
                                    <option value="popular_property">Ïù∏Í∏∞Î¨ºÍ±¥</option>
                                </select>
                            </div>
                        </dd>
                    </dl>

                    <dl>
                        <dt>Ï£ºÏÜå Í≤ÄÏÉâ</dt>
                        <dd>
                            <input type="text" id="keyword" name="keyword" placeholder="Í≤ÄÏÉâÌï† Î∂ÄÎèôÏÇ∞ Ï£ºÏÜå ÏûÖÎ†•">
                        </dd>
                    </dl>

                    <div class="srch-btn">
                        <button class="btn-dark" onclick="handleSearch()">Ï°∞Ìöå</button>
                    </div>
                </div>
            </div>
            <!-- Ïª®ÌÖêÏ∏† ÏòÅÏó≠  -->
            <div class="contents-wrap">
                <div class="list-top-wrap">
                    <div class="list-num">
                        Î™©Î°ù <span class="blue">- Í±¥</span>
                    </div>
                </div>
                <div id="addressWrap" class="contents-wrap">

                </div> <!--//card-wrap end-->
            </div> <!--// contents-wrap end-->
        </div> <!--//layout-contents end -->

    </div> <!-- //mobile-layout-contents end-->

    <div class="mobile-layout-popup">
        <div class="popup-overlay"></div>
        <div class="popup-wrapper" id="popup-own">
            <div class="popup-title">
                <h3>ÏÉÅÏÑ∏ ÎÇ¥Ïó≠</h3>
                <a title="ÌåùÏóÖÎã´Í∏∞" class="btn-popup-close">
                    <img src="/assets_mobile/images/icon/btn-popup-close.svg" alt="Îã´Í∏∞">
                </a>
            </div>
            <div class="popup-contents">
                <div class="ticket-tit">
                    <dl>
                        <dt>Ï£ºÏÜå</dt>
                        <dd></dd>
                    </dl>
                </div>
                <div class="list-card-wrap">

                </div>
                <div class="write-wrap">

                </div>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close btn-navy">ÌôïÏù∏</button>
            </div>
        </div>
    </div>


    <div class="mobile-layout-popup" id="popup-history">
        <!--<div class="popup-overlay"></div>-->
        <div class="popup-wrapper">
            <div class="popup-title">
                <h3>ÏÉÅÏÑ∏ÎÇ¥Ïö©</h3>
            </div>
            <div class="popup-contents">
                <div class="table-wrap">
                    <div class="write-wrap">
                        <section>
                            <div class="tab-wrap" style="width: 100%;">
                                <ul class="tab-links" style="margin-bottom: 10px;">
                                    <li><a href="#main" name="tabs_basic">ÌëúÏ†úÎ∂Ä</a></li>
                                    <li><a href="#sub1" name="tab_production">Í∞ëÍµ¨</a></li>
                                    <li><a href="#sub2" name="tab_production">ÏùÑÍµ¨</a></li>
                                </ul>

                                <section class="tab-item" id="main">
                                    <table class="write-table"
                                           style="width: 100%; border-collapse: collapse; table-layout: fixed; ">
                                        <caption style="text-align: left; margin-bottom: 8px;">ÏÉÅÏÑ∏ÌÖåÏù¥Î∏î</caption>
                                        <thead>
                                        <tr>
                                            <th colspan="4" style="text-align: center;">Ìëú Ï†ú Î∂Ä (Í±¥Î¨ºÏùò ÌëúÏãú)</th>
                                        </tr>

                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>Ï†ëÏàò</label>
                                            </th>
                                            <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">

                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>ÏÜåÏû¨ÏßÄÎ≤à,Í±¥Î¨ºÎ™ÖÏπ≠ Î∞è Î≤àÌò∏</label>
                                            </th>
                                            <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">

                                            </td>
                                        </tr>

                                        <tr>
                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>ÏÜåÏû¨ÏßÄÎ≤à</label>
                                            </th>
                                            <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">

                                            </td>
                                        </tr>

                                        <tr>
                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>ÏßÄÎ™©</label>
                                            </th>
                                            <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">

                                            </td>

                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>Î©¥Ï†Å</label>
                                            </th>
                                            <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">

                                            </td>
                                        </tr>

                                        <tr>
                                            <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                                                <label>Ï±ÑÍ∂åÏµúÍ≥†Ïï°Îì±</label>
                                            </th>
                                            <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </section>


                                <section class="tab-item" id="sub1">
                                    <table class="write-table"
                                           style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                        <caption style="text-align: left; margin-bottom: 8px;">ÏÉÅÏÑ∏ÌÖåÏù¥Î∏î</caption>
                                        <thead>
                                        <tr>
                                            <th colspan="4" style="text-align: center;">Í∞ë Íµ¨ (ÏÜåÏú†Í∂åÏóê Í¥ÄÌïú ÏÇ¨Ìï≠)</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        <tr>
                                            <th style="font-size: 11px;">
                                                Îì±Í∏∞Î™©Ï†Å
                                            </th>
                                            <td colspan="3">

                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="font-size: 11px;">
                                                Ï†ëÏàò
                                            </th>
                                            <td colspan="3">

                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="font-size: 11px;">
                                                Îì±Í∏∞ÏõêÏù∏
                                            </th>
                                            <td colspan="3">

                                            </td>
                                        </tr>

                                        <tr>
                                            <th style="font-size: 11px; text-align: center;" colspan="4">Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠</th>

                                        </tr>
                                        <tr>
                                            <td colspan="4">

                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </section>

                                <section class="tab-item" id="sub2">
                                    <table class="write-table"
                                           style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                        <caption style="text-align: left; margin-bottom: 8px;">ÏÉÅÏÑ∏ÌÖåÏù¥Î∏î</caption>
                                        <thead>
                                        <tr>
                                            <th colspan="4" style="text-align: center;">ÏùÑ Íµ¨ (ÏÜåÏú†Í∂å Ïù¥Ïô∏Ïùò Í∂åÎ¶¨Ïóê Í¥ÄÌïú ÏÇ¨Ìï≠)</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        <tr>
                                            <th style="font-size: 11px;">
                                                Îì±Í∏∞Î™©Ï†Å
                                            </th>
                                            <td colspan="3">

                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="font-size: 11px;">
                                                Ï†ëÏàò
                                            </th>
                                            <td colspan="3">

                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="font-size: 11px;">
                                                Îì±Í∏∞ÏõêÏù∏
                                            </th>
                                            <td colspan="3">

                                            </td>
                                        </tr>

                                        <tr>
                                            <th style="font-size: 11px; text-align: center;" colspan="4">Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠</th>

                                        </tr>
                                        <tr>
                                            <td colspan="4">

                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </section>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close btn-navy">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!--Ïù¥Î†•Î≥¥Í∏∞ ÌåùÏóÖ-->
    <div class="mobile-layout-popup">
        <div class="popup-wrapper" id="popup-details">
            <div class="popup-title">
                <h3>Ïù¥Î†• ÎÇ¥Ïó≠</h3>
                <a title="ÌåùÏóÖÎã´Í∏∞" class="btn-popup-close">
                    <img src="/assets_mobile/images/icon/btn-popup-close.svg" alt="Îã´Í∏∞">
                </a>
            </div>
            <div class="popup-contents">
                <div class="ticket-tit">
                    <dl>
                        <dd></dd>
                    </dl>
                </div>
                <div class="table-container">
                    <div class="list-table-wrap" style="overflow-x: auto;">

                    </div>
                </div>
                <div class="write-wrap">
                </div>
            </div>
            <div class="popup-button">
                <button class="btn-popup-close btn-navy">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

</div> <!-- //page-wrapper end-->

<script th:inline="javascript">
    // // ThymeleafÏóêÏÑú Í∞í ÏÑ§Ï†ï: Null Ï≤¥ÌÅ¨ÏôÄ Í∏∞Î≥∏Í∞í Ï≤òÎ¶¨
    // var groupid = [[${session.groupid != null ? session.groupid : 'null'}]];
    // var id = /*[[${id != null ? id : 'null'}]]*/;
    // var groupname = /*[[${groupname != null ? groupname : 'null'}]]*/;
    // var username = /*[[${username != null ? username : 'null'}]]*/;
    //
    // // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Í∞í Ïú†ÏßÄ (null ÎòêÎäî Îπà Î¨∏ÏûêÏó¥ÏùÄ Ï†ÄÏû•ÌïòÏßÄ ÏïäÏùå)
    // if (groupid && groupid !== 'null') localStorage.setItem('groupid', groupid);
    // if (id && id !== 'null') localStorage.setItem('id', id);
    // if (username && username !== 'null') localStorage.setItem('username', username);
    // if (groupname && groupname !== 'null') localStorage.setItem('groupname', groupname);
</script>


<script type="text/javascript">

    document.readyState === 'complete' ? init() : window.onload = init;

    function formatDate(date) {
        let yyyy = date.getFullYear();
        let mm = String(date.getMonth() + 1).padStart(2, '0');
        let dd = String(date.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
    }

    function updateDateRange() {
        const selectedValue = document.getElementById('property').value;
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');

        let newStartDate;
        const today = new Date(); // ÌòÑÏû¨ ÎÇ†Ïßú

        if (selectedValue === "my_property") {
            newStartDate = new Date(today.getFullYear(), 0, 1); // Ïò¨Ìï¥ 1Ïõî 1Ïùº
        } else if (selectedValue === "recent_property") {
            newStartDate = new Date(today);
            newStartDate.setMonth(today.getMonth() - 1); // Ìïú Îã¨ Ï†Ñ
        } else if (selectedValue === "most_viewed_property") {
            newStartDate = new Date(today);
            newStartDate.setFullYear(today.getFullYear() - 1); // Ïùº ÎÖÑ Ï†Ñ
        } else if (selectedValue === "popular_property") {
            newStartDate = new Date(today);
            newStartDate.setDate(today.getDate() - 14); // 2Ï£º Ï†Ñ
        }

        startDateInput.value = formatDate(newStartDate);
        endDateInput.value = formatDate(today);
    }

    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä (select Í∞íÏù¥ Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ïã§Ìñâ)
    document.getElementById('property').addEventListener('change', updateDateRange);

    // üîπ **Ï¥àÍ∏∞ Ïã§Ìñâ Ïãú select ÏöîÏÜåÏùò ÌòÑÏû¨ Í∞íÏúºÎ°ú ÎÇ†Ïßú ÏÑ§Ï†ï**
    document.addEventListener("DOMContentLoaded", updateDateRange);


    function init() {
        fetchListData();
    }

    function maskName(name) {
        if (!name) return '';  // nameÏù¥ ÎπÑÏñ¥ ÏûàÏúºÎ©¥ Îπà Î¨∏ÏûêÏó¥ÏùÑ Î∞òÌôò

        const maskedPart = name.slice(1);  // Ï≤´ Í∏ÄÏûê Ï†úÏô∏ÌïòÍ≥† ÎÇòÎ®∏ÏßÄ Î∂ÄÎ∂Ñ
        const masked = '*'.repeat(Math.max(0, maskedPart.length));  // ÏùåÏàò Î∞©ÏßÄ, ÏµúÏÜå 0 Ïù¥ÏÉÅÏúºÎ°ú ÏÑ§Ï†ï

        return name[0] + masked;  // Ï≤´ Í∏ÄÏûêÎäî Í∑∏ÎåÄÎ°ú ÎëêÍ≥† ÎÇòÎ®∏ÏßÄÎäî *Î°ú ÎßàÏä§ÌÇπ
    }


    // Îç∞Ïù¥ÌÑ∞Î•º Î∞õÏïÑÏôÄ Ïπ¥Îìú Î†åÎçîÎßÅ
    function fetchListData() {
        let startDate = $('#startDate').val();
        let endDate = $('#endDate').val();
        let property = $('#property').val();
        let keyword = $('#keyword').val();


        /* console.log("Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞:", startDate, endDate, property); // ÏΩòÏÜî ÌôïÏù∏*/

        $.ajax({
            url: '/api/mobile_production/read_all',
            type: 'GET',
            data: {
                'search_startDate': startDate,
                'search_endDate': endDate,
                'search_property': property,
                'keyword': keyword
            },
            success: function (data) {


                const propertyData = data[property];

                // Î™©Î°ù Í±¥Ïàò ÏóÖÎç∞Ïù¥Ìä∏
                const listNumElement = document.querySelector('.list-num .blue');
                if (listNumElement) {
                    listNumElement.textContent = `${propertyData && propertyData.length ? propertyData.length : 0} Í±¥`;
                }

                // Ï£ºÏÜå Î¶¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
                const listAddressWrap = document.getElementById('addressWrap');
                if (!listAddressWrap) {
                    console.error("addressWrap ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
                    return;
                }

                listAddressWrap.innerHTML = ''; // Í∏∞Ï°¥ ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî

                if (propertyData === null || propertyData.length === 0) {
                    console.log("Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÍ±∞ÎÇò ÎπÑÏñ¥ ÏûàÏäµÎãàÎã§.");
                    return;
                }

                const availableColors = ['card-purple'];
                let colorIndex = 0;
                let htmlContent = '';

                const selectedValue = $('#property').val();
                console.log(JSON.stringify(propertyData, null, 2));

                propertyData.forEach(item => {
                    const cardColor = availableColors[colorIndex];
                    const {bgColor, textColor} = getBadgeColorByScore(item.REALSCORE); // Î∞∞Í≤ΩÏÉâ Í∞ÄÏ†∏Ïò§Í∏∞
                    const badgeGrade = getBadgeClass(item.REALSCORE); // Îì±Í∏â Í∞ÄÏ†∏Ïò§Í∏∞
                    colorIndex = (colorIndex + 1) % availableColors.length;

                    let buttonsHtml = `
                  <div style="display: flex; gap: 5px; align-items: center; max-width: 100%;">
                    <button class="btn btn-popup-open" data-popup="popup-history" title="ÏÉÅÏÑ∏Î≥¥Í∏∞" style="margin-bottom: 0px;  border-radius: 20px; transition: background-color 0.3s ease;">ÏÉÅÏÑ∏Î≥¥Í∏∞ </button>
                     <button class="btn btn-popup-open" data-popup="popup-details" title="Ïù¥Î†•Î≥¥Í∏∞" style="margin-top: 5px;margin-bottom: 5px; padding: 4px 12px; border-radius: 20px; transition: background-color 0.3s ease;  ">Î≥ÄÍ≤ΩÎêú Ïù¥Î†•Î≥¥Í∏∞</button>
                  </div>`;

                    // ÎÇ†Ïßú Ìè¨Îß∑ Î≥ÄÍ≤Ω
                    const date = new Date(item.Sreqdate);
                    date.setHours(date.getHours() + 9); // UTC -> KST Î≥ÄÌôò

                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");

                    const formattedDate = `${year}-${month}-${day}`;

                    /*console.log(formattedDate);*/

                    // Suserid Í∞íÏù¥ 'super' ÎòêÎäî 'admin'Ïù¥Î©¥ ÎßàÏä§ÌÇπÌïòÏßÄ ÏïäÏùå
                    const maskedUserName = (item.Suserid && (item.Suserid === 'super' || item.Suserid === 'admin'))
                        ? item.Suserid[0] + '****'
                        : maskName(item.USERNM || '');


                    htmlContent += `
                        <div class="card-box ${cardColor}" data-realadd="${item.REALADD}" data-resido="${item.RESIDO}" data-realid="${item.REALID}"
                    data-regdate="${item.REGDATE}" data-regugun="${item.REGUGUN}" data-rejimok="${item.REJIMOK}" data-rearea="${item.REAREA}"
                    data-remaxamt="${item.REMAXAMT}" data-uniqueNo="${item.UniqueNo}" style="margin-bottom: 10px;">

                            <div class="card-cont">
                                 ${selectedValue !== "most_viewed_property" ? `

                                 <dl class="card-address">
                                    <dd>${item.REALADD}</dd>
                                </dl>
                                    <dl>
                                        <dt>ÌöåÏõêÎ™Ö</dt>
                                        <dd>${maskedUserName}</dd>
                                    </dl>` : ''}
                                 ${
                                        (selectedValue === "recent_property" || selectedValue === "popular_property")
                                            ? `<dl>
                                <dt>ÏµúÍ∑ºÏ°∞ÌöåÎÇ†Ïßú</dt>
                                <dd>${formattedDate}</dd>
                            </dl>`
                                            : selectedValue === "most_viewed_property"
                                                ? `<dl>
                                <dt>ÏµúÍ∑ºÎ∞úÍ∏âÎÇ†Ïßú</dt>
                                <dd>${item.WksbiBalDate}</dd>
                            </dl>`
                                                : selectedValue === "my_property"
                                                    ? `<dl>
                                <dt>Ï°∞ÌöåÎÇ†Ïßú</dt>
                                <dd>${formattedDate}</dd>
                            </dl>`
                                                    : ''
                                    }

                                 <dl>
                                    <dt>ÌåêÏ†ïÏ†êÏàò</dt>
                                    <dd>${item.REALSCORE}</dd>
                                </dl>
                            <dl>
                              <dt>Îì±Í∏â</dt>
                              <dd>
                                  <div class="badge" style="background: ${bgColor}; color: ${textColor}; font-size: 15px;">
                                      ${badgeGrade} Îì±Í∏â
                                  </div>
                              </dd>
                            </dl>
                              ${(selectedValue === "recent_property" || selectedValue === "popular_property") ? `
                                <dl>
                                    <dt>Ï°∞ÌöåÏàò</dt>
                                    <dd>${item.record_count}</dd>
                                </dl>
                                ` : selectedValue === "most_viewed_property" ? `
                                <dl>
                                    <dt>Î∞úÍ∏âÌöüÏàò</dt>
                                    <dd>${item.PinNo_Count}</dd>
                                </dl>
                                ` : ''}
                            </div>
                                ${buttonsHtml}
                        </div>
                    `;
                });

                listAddressWrap.innerHTML = htmlContent;

                // cardBox ÏöîÏÜåÎì§Ïù¥ DOMÏóê Ï∂îÍ∞ÄÎêú ÌõÑ, data-ranknoA ÏÜçÏÑ± ÏÑ§Ï†ï
                const cardBoxes = listAddressWrap.querySelectorAll('.card-box'); // Î™®Îì† card-box ÏöîÏÜå ÏÑ†ÌÉù

                cardBoxes.forEach(cardBox => {
                    const item = propertyData.find(dataItem => dataItem.REALID === Number(cardBox.dataset.realid)); // Î¨∏ÏûêÏó¥ ÎπÑÍµêÎ•º ÏúÑÌï¥ Number() Ï∂îÍ∞Ä
                    if (item) {  // itemÏù¥ undefinedÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå ÏÜçÏÑ± ÏÑ§Ï†ï
                        cardBox.setAttribute('data-ranknoA', JSON.stringify(item.RankNo_a_data));
                        /*   console.log("data-ranknoA ÏÑ§Ï†ï:", cardBox.dataset.realid, JSON.stringify(item.RankNo_a_data)); // ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï∂îÍ∞Ä*/
                    } else {
                        /*console.log("Ìï¥Îãπ REALIDÎ•º Í∞ÄÏßÑ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:", cardBox.dataset.realid); // ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï∂îÍ∞Ä*/
                    }
                });


                cardBoxes.forEach(cardBox => {
                    const item = propertyData.find(dataItem => dataItem.REALID === Number(cardBox.dataset.realid)); // Î¨∏ÏûêÏó¥ ÎπÑÍµêÎ•º ÏúÑÌï¥ Number() Ï∂îÍ∞Ä
                    if (item) {  // itemÏù¥ undefinedÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå ÏÜçÏÑ± ÏÑ§Ï†ï
                        cardBox.setAttribute('data-ranknoB', JSON.stringify(item.RankNo_b_data));
                        /* console.log("data-ranknoB ÏÑ§Ï†ï:", cardBox.dataset.realid, JSON.stringify(item.RankNo_b_data)); // ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï∂îÍ∞Ä*/
                    } else {
                        /*console.log("Ìï¥Îãπ REALIDÎ•º Í∞ÄÏßÑ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:", cardBox.dataset.realid); // ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï∂îÍ∞Ä*/
                    }
                });

                listAddressWrap.addEventListener('click', (event) => {
                    const button = event.target.closest('.btn-popup-open[data-popup="popup-history"]');
                    const delButton = event.target.closest('.btn-popup-open[data-popup="popup-details"]');
                    if (delButton) {
                        const cardBox = delButton.closest('.card-box');
                        if (!cardBox) return;

                        const realid = cardBox.getAttribute("data-realid");
                        const address = cardBox.getAttribute('data-realadd') || "Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå";

                        if (!realid) {
                            console.warn("REALID ÏóÜÏùå!");
                            return;
                        }

                        console.log("Ïù¥Î†•Î≥¥Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®! REALID, address:", realid, address);

                        handleClick(realid, address);
                    }

                    if (!button) return; // ÌÅ¥Î¶≠Îêú ÏöîÏÜåÍ∞Ä Î≤ÑÌäºÏù¥ ÏïÑÎãå Í≤ΩÏö∞ Î¨¥Ïãú

                    const cardBox = button.closest('.card-box');

                    const realAdd = cardBox.getAttribute('data-realadd');
                    const resido = cardBox.getAttribute('data-resido') || '';
                    const regdate = cardBox.getAttribute('data-regdate') || '';
                    const regugun = cardBox.getAttribute('data-regugun') || '';
                    const rejimok = cardBox.getAttribute('data-rejimok') || '';

                    const rearea = cardBox.getAttribute('data-rearea') || '';
                    const formattedrearea = (rearea === null || rearea === "null") ? "" : rearea;

                    const uniqueNo = cardBox.getAttribute('data-uniqueNo');
                    const uniqueNoSafe = (uniqueNo === null || uniqueNo === "null") ? "" : uniqueNo;
                    const remaxamt = cardBox.getAttribute('data-remaxamt') || '';
                    const formattedRemaxamt = (remaxamt === null || remaxamt === "null")
                        ? ""
                        : Number(remaxamt).toLocaleString(undefined, {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });


                    // ÌåùÏóÖ ÌÉÄÏù¥ÌãÄ ÏóÖÎç∞Ïù¥Ìä∏
                    const popupTitle = document.querySelector("#popup-history .popup-title h3");
                    if (popupTitle) {
                        popupTitle.textContent = `${realAdd} ÏÉÅÏÑ∏ÎÇ¥Ïö©`;
                    }

                    // ÎÇ†Ïßú Ìè¨Îß∑ Î≥ÄÍ≤Ω
                    const formattedRegDate = regdate
                        ? regdate.substring(0, 4) + 'ÎÖÑ' + regdate.substring(4, 6) + 'Ïõî' + regdate.substring(6, 8) + 'Ïùº'
                        : '';

                    // ÌëúÏ†úÎ∂Ä
                    const tds = document.querySelectorAll("#popup-history td[colspan='3']");
                    if (tds.length > 0) {
                        tds[0].textContent = formattedRegDate;
                        tds[1].textContent = realAdd + " " + uniqueNoSafe;
                        tds[2].textContent = resido + " " + regugun;
                        tds[3].textContent = formattedRemaxamt;
                    } else {
                        /*console.error("Ìï¥Îãπ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");*/
                    }
                    const rows = document.querySelector("#popup-history table tbody").getElementsByTagName("tr");
                    if (rows.length >= 4) {
                        const tds = rows[3].getElementsByTagName("td");
                        if (tds.length >= 2) {
                            tds[0].textContent = rejimok;
                            tds[1].textContent = formattedrearea;
                        }
                    }


                    // Í∞ëÍµ¨
                    const rankNoAData = cardBox.getAttribute('data-ranknoA');
                    let parsedRankNoAData = JSON.parse(rankNoAData);
                    if (typeof parsedRankNoAData === "string") {
                        parsedRankNoAData = JSON.parse(parsedRankNoAData);
                    }

                    const dataArray = Array.isArray(parsedRankNoAData) ? parsedRankNoAData : [parsedRankNoAData];

                    const sub1Table = document.querySelector("#sub1 table tbody");
                    sub1Table.innerHTML = "";

                    // Í≥µÌÜµ Ïä§ÌÉÄÏùºÏùÑ ÏúÑÌïú Î≥ÄÏàò ÏÑ§Ï†ï
                    const cellStyle = "font-size: 12px; border-right: 1px solid #E6E6E6; border-bottom: 1px solid #E6E6E6; text-align: center; padding: 5px;";
                    const cellColSpan3Style = "border-bottom: 1px solid #E6E6E6; padding: 5px;";
                    const cellColSpan4Style = "border-bottom: 1px solid #E6E6E6; padding: 5px;";

                    // Í≥µÌÜµÏúºÎ°ú ÏÇ¨Ïö©Ìï† Ìï®Ïàò ÏÉùÏÑ±
                    function createTableRow(table, headerText, cellValue, colSpan = 3) {
                        const row = table.insertRow();
                        const headerCell = document.createElement("th");
                        headerCell.textContent = headerText;
                        headerCell.style.cssText = cellStyle;
                        row.appendChild(headerCell);

                        const etcCell = row.insertCell();
                        etcCell.colSpan = colSpan;
                        etcCell.innerHTML = cellValue ?? "&nbsp;"; // nullÏù∏ Í≤ΩÏö∞ Í≥µÎ∞± Ï≤òÎ¶¨
                        etcCell.style.cssText = cellColSpan3Style;
                    }

                    if (dataArray.length === 0) {
                        // 'Îì±Í∏∞Î™©Ï†Å', 'Ï†ëÏàò', 'Îì±Í∏∞ÏõêÏù∏' Ìï≠Î™©ÏùÑ Ìïú Î≤àÎßå Ï∂îÍ∞Ä
                        createTableRow(sub1Table, "Îì±Í∏∞Î™©Ï†Å", "&nbsp;", 3);
                        createTableRow(sub1Table, "Ï†ëÏàò", "&nbsp;", 3);
                        createTableRow(sub1Table, "Îì±Í∏∞ÏõêÏù∏", "&nbsp;", 3);

                        // 'Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠' Ï†úÎ™©Í≥º Í≥µÎ∞±ÏùÑ Ìïú Î≤àÎßå Ï∂îÍ∞Ä
                        const row4 = sub1Table.insertRow();
                        const headerCell4 = document.createElement("th");
                        headerCell4.textContent = "Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠";
                        headerCell4.style.cssText = "font-size: 11px; text-align: center; padding: 5px;";
                        headerCell4.colSpan = 4;
                        row4.appendChild(headerCell4);

                        const row5 = sub1Table.insertRow();
                        const etcCell5 = row5.insertCell();
                        etcCell5.colSpan = 4;
                        etcCell5.innerHTML = "&nbsp;"; // Í≥µÎ∞± Ï∂îÍ∞Ä
                        etcCell5.style.cssText = cellColSpan4Style;
                    } else {
                        dataArray.forEach(data => {
                            createTableRow(sub1Table, "Îì±Í∏∞Î™©Ï†Å", (data.RgsAimCont_a === "null" || data.RgsAimCont_a === null ? "" : data.RgsAimCont_a), 3);
                            createTableRow(sub1Table, "Ï†ëÏàò", (data.Receve_a === "null" || data.Receve_a === null ? "" : data.Receve_a), 3);
                            createTableRow(sub1Table, "Îì±Í∏∞ÏõêÏù∏", (data.RgsCaus_a === "null" || data.RgsCaus_a === null ? "" : data.RgsCaus_a), 3);

                            // Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠
                            const row4 = sub1Table.insertRow();
                            const headerCell = document.createElement("th");
                            headerCell.textContent = "Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠";
                            headerCell.style.cssText = "font-size: 12px; text-align: center; border-right: 1px solid #E6E6E6; border-bottom: 1px solid #E6E6E6;";
                            headerCell.colSpan = 4;
                            row4.appendChild(headerCell);

                            const row5 = sub1Table.insertRow();
                            const etcCell = row5.insertCell();
                            etcCell.colSpan = 4;
                            etcCell.textContent = (data.NomprsAndEtc_a === "null" ? "" : data.NomprsAndEtc_a);
                            etcCell.style.cssText = cellColSpan4Style;
                        });
                    }


                    //ÏùÑÍµ¨
                    const rankNoBData = cardBox.getAttribute('data-ranknoB');
                    let parsedRankNoBData = JSON.parse(rankNoBData);
                    if (typeof parsedRankNoBData === "string") {
                        parsedRankNoBData = JSON.parse(parsedRankNoBData);
                    }

                    const dataBrray = Array.isArray(parsedRankNoBData) ? parsedRankNoBData : [parsedRankNoBData];
                    const sub2Table = document.querySelector("#sub2 table tbody");
                    sub2Table.innerHTML = "";

                    if (dataBrray.length === 0) {
                        // 'Îì±Í∏∞Î™©Ï†Å', 'Ï†ëÏàò', 'Îì±Í∏∞ÏõêÏù∏' Ìï≠Î™©ÏùÑ Ìïú Î≤àÎßå Ï∂îÍ∞Ä
                        createTableRow(sub2Table, "Îì±Í∏∞Î™©Ï†Å", "&nbsp;", 3);
                        createTableRow(sub2Table, "Ï†ëÏàò", "&nbsp;", 3);
                        createTableRow(sub2Table, "Îì±Í∏∞ÏõêÏù∏", "&nbsp;", 3);

                        // 'Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠' Ï†úÎ™©Í≥º Í≥µÎ∞±ÏùÑ Ìïú Î≤àÎßå Ï∂îÍ∞Ä
                        const row4 = sub2Table.insertRow();
                        const headerCell4 = document.createElement("th");
                        headerCell4.textContent = "Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠";
                        headerCell4.style.cssText = "font-size: 11px; text-align: center; padding: 5px;";
                        headerCell4.colSpan = 4;
                        row4.appendChild(headerCell4);

                        const row5 = sub2Table.insertRow();
                        const etcCell5 = row5.insertCell();
                        etcCell5.colSpan = 4;
                        etcCell5.innerHTML = "&nbsp;"; // Í≥µÎ∞± Ï∂îÍ∞Ä
                        etcCell5.style.cssText = cellColSpan4Style;
                    } else {
                        dataBrray.forEach(data => {
                            createTableRow(sub2Table, "Îì±Í∏∞Î™©Ï†Å", (data.RgsAimCont_b === "null" || data.RgsAimCont_b === null ? "" : data.RgsAimCont_b), 3);
                            createTableRow(sub2Table, "Ï†ëÏàò", (data.Receve_b === "null" || data.Receve_b === null ? "" : data.Receve_b), 3);
                            createTableRow(sub2Table, "Îì±Í∏∞ÏõêÏù∏", (data.RgsCaus_b === "null" || data.RgsCaus_b === null ? "" : data.RgsCaus_b), 3);

                            // Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠
                            const row4 = sub2Table.insertRow();
                            const headerCell = document.createElement("th");
                            headerCell.textContent = "Í∂åÎ¶¨Ïûê Î∞è Í∏∞ÌÉÄÏÇ¨Ìï≠";
                            headerCell.style.cssText = "font-size: 12px; text-align: center; border-right: 1px solid #E6E6E6; border-bottom: 1px solid #E6E6E6;";
                            headerCell.colSpan = 4;
                            row4.appendChild(headerCell);

                            const row5 = sub2Table.insertRow();
                            const etcCell = row5.insertCell();
                            etcCell.colSpan = 4;
                            etcCell.textContent = (data.NomprsAndEtc_b === "null" ? "" : data.NomprsAndEtc_b);
                            etcCell.style.cssText = cellColSpan4Style;
                        });
                    }


                    // ÌåùÏóÖ Ïó¥Í∏∞
                    const popupHistory = document.getElementById("popup-history");
                    popupHistory.classList.add("open");

                    // Î™®Îì† ÌÉ≠ ÎÇ¥Ïö©ÏùÑ Ïà®ÍπÅÎãàÎã§
                    const tabItems = popupHistory.querySelectorAll('.tab-item');
                    tabItems.forEach(item => {
                        item.classList.remove('active');  // Î™®Îì† ÌÉ≠ ÎÇ¥Ïö© Ïà®Í∏∞Í∏∞
                    });

                    // 'main' ÌÉ≠Îßå ÌôúÏÑ±Ìôî
                    const mainTab = popupHistory.querySelector('#main');
                    if (mainTab) {
                        mainTab.classList.add('active');  // 'main' ÌÉ≠Îßå ÌëúÏãú
                    }

                });

            },
            error: function (xhr, status, error) {
                console.error("AJAX ÏöîÏ≤≠ Ïã§Ìå®:", status, error);
                console.error("ÏùëÎãµ ÎÇ¥Ïö©:", xhr.responseText);
            }
        });
    }


    function handleSearch() {
        fetchListData();
        closeSearch();
    }

    // Ï°∞ÌöåÎ≤ÑÌäº ÌÅ¥Î¶≠Ïãú Í≤ÄÏÉâÏ∞Ω close
    function closeSearch() {
        document.querySelector('.btn-aco').click();
    }

    function getBadgeColorByScore(score) {
        if (score === "ÎØ∏ÌôïÏù∏") return {bgColor: "#DADADA", textColor: "black"}; // Ï†êÏàò ÏóÜÏùå (ÌöåÏÉâ)
        let numericScore = parseFloat(score);

        if (numericScore >= 90) return {bgColor: "#F4F4F4", textColor: "black"}; // S Îì±Í∏â (ÏïàÏã¨) ‚Üí Ïó∞Ìïú ÌöåÏÉâ (Í≤ÄÏùÄ Í∏ÄÏî®)
        if (numericScore >= 80) return {bgColor: "#4CAF50", textColor: "white"}; // A Îì±Í∏â (Í¥ÄÏã¨) ‚Üí ÎÖπÏÉâ
        if (numericScore >= 70) return {bgColor: "#3069B3", textColor: "white"}; // B Îì±Í∏â (Ï£ºÏùò) ‚Üí ÌååÎûÄÏÉâ
        if (numericScore >= 60) return {bgColor: "#FFC107", textColor: "black"}; // C Îì±Í∏â (Í≤ΩÍ≥Ñ) ‚Üí ÎÖ∏ÎûÄÏÉâ
        if (numericScore >= 50) return {bgColor: "#FF8C00", textColor: "white"}; // D Îì±Í∏â (Î∂àÏïà) ‚Üí Ï£ºÌô©ÏÉâ
        if (numericScore >= 40) return {bgColor: "#EC193A", textColor: "white"}; // E Îì±Í∏â (Ïã¨Í∞Å) ‚Üí Îπ®Í∞ÑÏÉâ
        return {bgColor: "#1D1D1D", textColor: "white"}; // F Îì±Í∏â (ÏúÑÌóò) ‚Üí Í≤ÄÏùÄÏÉâ (Ìù∞ Í∏ÄÏî®)
    }
    function getBadgeClass(score) {
        if (score >= 90) return "S"; // S Îì±Í∏â (ÏïàÏã¨)
        if (score >= 80) return "A"; // A Îì±Í∏â (Í¥ÄÏã¨)
        if (score >= 70) return "B"; // B Îì±Í∏â (Ï£ºÏùò)
        if (score >= 60) return "C"; // C Îì±Í∏â (Í≤ΩÍ≥Ñ)
        if (score >= 50) return "D"; // D Îì±Í∏â (Î∂àÏïà)
        if (score >= 40) return "E"; // E Îì±Í∏â (Ïã¨Í∞Å)
        return "F"; // F Îì±Í∏â (ÏúÑÌóò)
    }

    function handleClick(realid, address) {
        $.ajax({
            url: "/api/IssueInquiry/popupDetails",
            type: "GET",
            data: {realid: realid},
            headers: {
                'X-CSRF-Token': $('[name=_csrf]').val()
            },
            success: function (response) {
                console.log("ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞(Ïù¥Î†• Î≥¥Í∏∞):", response);

                if (response.success) {
                    let regDateMap = {};
                    let regScoreMap = {};

                    if (response.findPinNO && response.findPinNO.length > 0) {
                        response.findPinNO.forEach(item => {
                            if (item.REALID) {
                                regDateMap[item.REALID] = item.INDATEM || '';
                                regScoreMap[item.REALID] = item.REALSCORE || '';
                            }
                        });
                    }

                    let listData = {
                        REALID: realid,
                        SHORT_ADDR: address // Î∞õÏïÑÏò® Ï£ºÏÜåÍ∞í ÏÇ¨Ïö©
                    };

                    let transformedDataA = response.findnK ? response.findnK.map(item => ({
                        ...item,
                        INDATEM: regDateMap[item.REALID] || 'ÎØ∏ÌôïÏù∏',
                        REALSCORE: regScoreMap[item.REALID] || 'ÎØ∏ÌôïÏù∏',
                        displayText: `[Í∞ëÍµ¨] ${item.RgsAimCont}`
                    })) : [];

                    let transformedDataB = response.findnE ? response.findnE.map(item => ({
                        ...item,
                        INDATEM: regDateMap[item.REALID] || 'ÎØ∏ÌôïÏù∏',
                        REALSCORE: regScoreMap[item.REALID] || 'ÎØ∏ÌôïÏù∏',
                        displayText: `[ÏùÑÍµ¨] ${item.RgsAimCont}`
                    })) : [];

                    updatePopupContent(transformedDataA, transformedDataB, listData);
                    $('.list-card-wrap').scrollTop(0);
                } else {
                    console.warn("Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå:", response.message);
                    Alert.alert('', "Ìï¥Îãπ Î¨ºÍ±¥Ïóê ÎåÄÌïú Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
                }
            },
            error: function (xhr, status, error) {
                console.error("AJAX ÏöîÏ≤≠ Ïã§Ìå®:", status, error);
                Alert.alert("ÏÑúÎ≤ÑÏôÄÏùò ÌÜµÏã† Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
            }
        });
    }

    function formatDateTo12Hour(indatem) {
        if (!indatem) return "ÎØ∏ÌôïÏù∏";

        let dateObj = new Date(indatem);
        let year = dateObj.getFullYear();
        let month = String(dateObj.getMonth() + 1).padStart(2, '0');
        let day = String(dateObj.getDate()).padStart(2, '0');
        let hours = dateObj.getHours();
        let minutes = String(dateObj.getMinutes()).padStart(2, '0');
        let period = hours >= 12 ? "PM" : "AM";

        hours = hours % 12 || 12; // 12ÏãúÍ∞ÑÏ†ú Î≥ÄÌôò

        return `${year}-${month}-${day} ${hours}:${minutes} ${period}`;
    }

    function updatePopupContent(findnK, findnE, listData) {
        let popup = document.getElementById('popup-details');
        let overlay = document.querySelector('.popup-overlay');
        let listContainer = document.querySelector('.list-table-wrap');
        let addressField = document.querySelector('#popup-details .ticket-tit dd');

        addressField.textContent = listData?.SHORT_ADDR ?? 'Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå';

        listContainer.innerHTML = '';

        let allData = [...findnK.map(item => ({...item, type: 'K'})),
            ...findnE.map(item => ({...item, type: 'E'}))];

        if (allData.length === 0) {
            console.warn("Îì±Í∏∞Î∂ÄÎì±Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå");
            Alert.alert('', "Î≥ÑÎèÑÏùò Îì±Í∏∞Î™©Ï†ÅÏù¥ ÏóÜÏäµÎãàÎã§.");
            listContainer.innerHTML = '<p style="text-align: center; padding: 10px;">Ìï¥Îãπ Î¨ºÍ±¥Ïùò Îì±Í∏∞Î∂ÄÎì±Î≥∏ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
            return;
        }

        let groupedData = {};
        allData.forEach(item => {
            let indateTime = formatDateTo12Hour(item.INDATEM);
            let realId = item.REALID;
            let realScore = item.REALSCORE || '';

            let groupKey = `${indateTime}_${realId}`;

            if (!groupedData[groupKey]) {
                groupedData[groupKey] = {
                    items: [],
                    realScores: new Set()
                };
            }
            groupedData[groupKey].items.push(item);
            groupedData[groupKey].realScores.add(realScore);
        });

        Object.keys(groupedData)
            .sort((a, b) => {
                let [indateTimeA] = a.split("_");
                let [indateTimeB] = b.split("_");

                let dateA = new Date(indateTimeA);
                let dateB = new Date(indateTimeB);
                return dateB - dateA;
            })
            .forEach(groupKey => {
                let {items, realScores} = groupedData[groupKey];
                let [indateTime, realId] = groupKey.split("_");

                let realScoreText = Array.from(realScores).join(", ");
                let cardClass = getCardClassByScore(realScoreText);

                let tableHtml = `
                <table class="register-table" style="width: 100%; border-collapse: collapse; margin-bottom: 15px; overflow-x: auto;">
                    <thead>
                        <tr class="${cardClass}" style="background-color: #f2f2f2;">
                            <th colspan="7" style="padding: 8px; text-align: left;">Î∞úÍ∏âÏùºÏûê: ${indateTime} &nbsp;&nbsp;&nbsp;&nbsp; Ï†êÏàò: ${realScoreText}</th>
                        </tr>
                        <tr>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:80px;">ÏàúÏúÑÎ≤àÌò∏</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:200px;">Îì±Í∏∞ Î™©Ï†Å</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:200px;">ÎåÄÏÉÅ ÏÜåÏú†Ïûê</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:400px;text-align: left;">Ï£ºÏöî Îì±Í∏∞ÏÇ¨Ìï≠</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:300px;">Ï†ëÏàòÏ†ïÎ≥¥</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:80px;">Íµ¨Î∂Ñ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

                items.forEach(item => {
                    let sectionName = item.type === 'K' ? 'Í∞ëÍµ¨' : 'ÏùÑÍµ¨';

                    tableHtml += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${item?.RankNo || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item?.Purpose || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item?.TargetOwner || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;text-align: left;">${item?.Information || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item?.ReceiptInfo || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${sectionName}</td>
                    </tr>
                `;
                });

                tableHtml += `
                    </tbody>
                </table>
            `;

                listContainer.innerHTML += tableHtml;
            });

        popup.classList.add('active');
        overlay.style.display = 'block';
        popup.scrollTop = 0;
    }

    //Ï†êÏàòÎ≥Ñ Ïπ¥Îìú ÏÉâ
    function getCardClassByScore(score) {
        if (score === "ÎØ∏ÌôïÏù∏") return "card-white"; // Ï†êÏàò ÏóÜÏùå (S Îì±Í∏â: ÏïàÏã¨)
        let numericScore = parseFloat(score); // Ï†êÏàòÎ•º Ïà´ÏûêÎ°ú Î≥ÄÌôò

        if (numericScore >= 90) return "card-white"; // S Îì±Í∏â (ÏïàÏã¨)
        if (numericScore >= 80) return "card-green"; // A Îì±Í∏â (Í¥ÄÏã¨)
        if (numericScore >= 70) return "card-blue";  // B Îì±Í∏â (Ï£ºÏùò)
        if (numericScore >= 60) return "card-yellow"; // C Îì±Í∏â (Í≤ΩÍ≥Ñ)
        if (numericScore >= 50) return "card-orange"; // D Îì±Í∏â (Î∂àÏïà)
        if (numericScore >= 40) return "card-red";   // E Îì±Í∏â (Ïã¨Í∞Å)
        return "card-black"; // F Îì±Í∏â (ÏúÑÌóò)
    }

    $('.btn-popup-close').on('click', function () {
        $('.popup-overlay').fadeOut(200);
        $('.popup-wrapper').removeClass('active');

        $('.popup-contents').scrollTop(0).scrollLeft(0);
        $('.list-table-wrap').scrollTop(0).scrollLeft(0);
    });

</script>
</body>
</html>
