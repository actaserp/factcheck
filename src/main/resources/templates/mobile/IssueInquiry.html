<!DOCTYPE html>
<html lang="ko">
<style>
    .btn-clear {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }

    .btn-close {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }


    .tab-item {
        display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  íƒ­ ë‚´ìš©ì„ ìˆ¨ê¹ë‹ˆë‹¤ */
    }

    .tab-item.active {
        display: block; /* 'active' í´ë˜ìŠ¤ê°€ ìˆì„ ë•Œë§Œ í•´ë‹¹ íƒ­ ë‚´ìš©ì„ í‘œì‹œ */
    }


    .tab-links {
        display: flex;
        margin-left: 1px;
        margin-bottom: -1px;
        overflow: hidden;
    }

    .tab-links li {
        position: relative;
    }

    .tab-links li:first-child a {
        border-radius: 6px 0 0 0;
    }

    .tab-links li:last-child a {
        border-radius: 0 6px 0 0;
    }

    .tab-links li a {
        display: inline-flex;
        justify-content: center;
        min-width: 120px;
        padding: 3px 32px 15px 32px;
        color: #808080;
        font-size: 18px;
        font-weight: 700;
        text-align: center;
        transition: all .3s;
        border-bottom: 3px solid #C6C6C6;
    }


    .tab-links li:hover a {
        color: #4D4D4D;
        font-weight: 700;
        border-bottom: 3px solid #4D4D4D;
    }

    .tab-links li.active a {
        color: #03428E;
        font-weight: 700;
        border-bottom: 3px solid #03428E;
    }

    section .tab-links {
    }


    section .tab-links li a {
        padding: 8px 10px;
        margin-right: -1px;
        border: 1px solid #E4E4E4;
        background-color: #fff;
        color: #808080;
    }

    section .tab-links li:first-child a {
        border-radius: 12px 0 0 12px;
    }

    section .tab-links li:last-child a {
        border-radius: 0 12px 12px 0;
        margin-right: 0;
    }

    section .tab-links li.active a {
        background-color: #3069B3;
        color: #fff;
    }

    .tab-links-sub {
        display: flex;
        margin-left: 1px;
        margin-bottom: -1px;
        overflow: hidden;
    }

    .tab-links-sub li {
        position: relative;
    }

    .tab-links-sub li a {
        display: inline-flex;
        border: 1px solid #E4E4E4;
        justify-content: center;
        min-width: 90px;
        padding: 8px 32px 8px 32px;
        background-color: #fff;
        color: #333333;
        font-size: 17px;
        font-weight: 700;
        text-align: center;
        transition: all .3s;
    }

    .tab-links-sub li:hover a {
        border-radius: 3px 0 0 3px;
        color: #4D4D4D;
        border: 1px solid #E4E4E4;
        border-right: 1px solid #E4E4E4;
        border-left: 1px solid #E4E4E4;
        background-color: #f5f6fa;
    }

    .tab-links-sub li:first-child a {
        border-radius: 3px 0 0 3px;
        border-right: 0
    }

    .tab-links-sub li:first-child:hover a {
        border-radius: 3px 0 0 3px;
        color: #4D4D4D;
        border: 1px solid #b3b3b3;
        border-right: 0;
        background-color: #f5f6fa;
    }

    .tab-links-sub li:last-child a {
        border-radius: 0 3px 3px 0;
        border-left: 0
    }


    .tab-links-sub li:last-child:hover a {
        color: #4D4D4D;
        border: 1px solid #b3b3b3;
        border-left: 0;
        background-color: #f5f6fa;
        border-radius: 0 3px 3px 0;
        border-left: 0
    }

    .tab-links-sub li.active a {
        background-color: #2EC9D6;
        color: #fff;
        font-weight: 700;
        border: 1px solid #2EC9D6;
    }

    .tab-contents > section, .tab-item1 > .row > section:first-child {
        border-radius: 0 15px 15px 15px;
    }

    .tab-contents > .row > section {
        border-radius: 0 15px 15px 15px;
    }

    .table-container {
        display: flex;
    }

    .register-table {
        flex-shrink: 0; /* í¬ê¸°ê°€ ìë™ìœ¼ë¡œ ì¤„ì–´ë“¤ì§€ ì•Šê²Œ ì„¤ì • */
        min-width: 900px;
    }

    .register-table thead tr.card-green th { background-color: #F4FDFD; border: 1px solid #119891; border-left: 10px solid #119891; !important; }
    .register-table thead tr.card-blue th { background-color: #F7FBFF; border: 1px solid #3069B3; border-left: 10px solid #3069B3; !important; }
    .register-table thead tr.card-black th { background-color: #F8F8F8; border: 1px solid #1D1D1D; border-left: 10px solid #1D1D1D; !important; }
    .register-table thead tr.card-red th { background-color: #fffafb; border: 1px solid #EC193A; border-left: 10px solid #EC193A; !important; }
    .register-table thead tr.card-white th { background-color: #FFFFFF; border: 1px solid #DADADA; border-left: 10px solid #DADADA; !important; }
    .register-table thead tr.card-yellow th { background-color: #FFF9DB; border: 1px solid #FFC107; border-left: 10px solid #FFC107; !important; }
    .register-table thead tr.card-orange th { background-color: #FFE8D5; border: 1px solid #FF8C00; border-left: 10px solid #FF8C00; !important; }


</style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FACT CHECK</title>
  <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
  <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
  <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->
  <script th:inline="javascript">
    var sandanData = /*[[${session.sandanList}]]*/ [];
  </script>


  <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>

  <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>

  <script src="/js/common.js?v=1060"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script><!-- PDF.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <script src="/js/Mobile.js"></script>
</head>

<body>
<div class="mobile-wrapper page-IssueInquiry"><!-- â˜…í˜ì´ì§€ Classëª… -->
  <!-- [ëª¨ë°”ì¼] í—¤ë”  -->
  <div class="mobile-layout-header">
    <header>
      <div class="left">
        <a href="#" title="ì „ì²´ë©”ë‰´" class="logo">
        </a>
      </div>
      <div class="center" style="margin-left:35px;">
        <h2>ë‚´ê°€ ë°œê¸‰í•œ ë“±ê¸°ë¶€ ì¡°íšŒ</h2>
      </div>
      <div class="right">
        <a href="#" title="ì „ì²´ë©”ë‰´" class="btn-menu">
          <img src="/assets_mobile/images/icon/btn-menu.svg" alt="ì „ì²´ë©”ë‰´ ì•„ì´ì½˜">
        </a>
      </div>
    </header>
  </div> <!-- //mobile-layout-header end-->

  <!-- [ëª¨ë°”ì¼] ë©”ë‰´  -->
  <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>
  <!-- [ëª¨ë°”ì¼] ì»¨ë´ì¸   -->
  <div class="mobile-layout-contents">
    <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
    <div class="layout-contents">
      <!-- ê²€ìƒ‰ ì˜ì—­  -->
      <div class="search-wrap">
        <div class="srch-tit aco-hd">
          <p>ê¸°ë³¸ê²€ìƒ‰</p>
          <a href="#" title="ì—´ê¸°/ë‹«ê¸°" class="btn-aco">
            <img src="/assets_mobile/images/icon/ico-down.svg" alt="ì—´ê¸°/ë‹«ê¸°">
          </a>
        </div>
        <div class="srch-cont aco-cont">
          <dl>
            <dt>
              ì¡°íšŒì¼ì<span class="eq">*</span>
            </dt>
            <dd>
              <ul class="date-box">
                <li>
                  <input type="date" id="startDate" name="startDate">
                  <label for="startDate" class="hide">ì‹œì‘ì¼</label>
                </li>
                <li>
                  <input type="date" id="endDate" name="endDate">
                  <label for="endDate" class="hide">ì¢…ë£Œì¼</label>
                </li>
              </ul>
            </dd>
          </dl>
          <dl>
            <dt>ê²€ìƒ‰</dt>
            <dd>
              <div style="display: flex; gap: 10px">
                <div style="width: 100%">
                  <input type="text" id="SearchKeywords" placeholder="ì¡°íšŒí•  ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </div>
              </div>
            </dd>
          </dl>
          <div class="srch-btn">
            <button class="btn-dark" onclick="handleSearch()">ì¡°íšŒ</button>
          </div>
        </div>
      </div>
      <!-- ì»¨í…ì¸  ì˜ì—­  -->
      <div class="contents-wrap">
        <div class="list-top-wrap">
          <div class="list-num">
            ëª©ë¡ <span class="blue">- ê±´</span>
          </div>
        </div>
        <div id="addressWrap" class="contents-wrap">

        </div> <!--//card-wrap end-->
      </div> <!--// contents-wrap end-->
    </div> <!--//layout-contents end -->

  </div> <!-- //mobile-layout-contents end-->

  <div class="mobile-layout-popup" id="popup-history">
    <!--<div class="popup-overlay"></div>-->
    <div class="popup-wrapper">
      <div class="popup-title">
        <h3>ìƒì„¸ë‚´ìš©</h3>
      </div>
      <div class="popup-contents">
        <div class="table-wrap">
          <div class="write-wrap">
            <section>
              <div class="tab-wrap" style="width: 100%;">
                <ul class="tab-links" style="margin-bottom: 10px;">
                  <li><a href="#main" name="tabs_basic">í‘œì œë¶€</a></li>
                  <li><a href="#sub1" name="tab_production">ê°‘êµ¬</a></li>
                  <li><a href="#sub2" name="tab_production">ì„êµ¬</a></li>
                </ul>

                <section class="tab-item" id="main">
                  <table class="write-table"
                         style="width: 100%; border-collapse: collapse; table-layout: fixed; ">
                    <caption style="text-align: left; margin-bottom: 8px;">ìƒì„¸í…Œì´ë¸”</caption>
                    <thead>
                    <tr>
                      <th colspan="4" style="text-align: center;">í‘œ ì œ ë¶€ (ê±´ë¬¼ì˜ í‘œì‹œ)</th>
                    </tr>

                    </thead>
                    <tbody>
                    <tr>
                      <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                        <label>ì ‘ìˆ˜</label>
                      </th>
                      <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">

                      </td>
                    </tr>
                    <tr>
                      <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                        <label>ì†Œì¬ì§€ë²ˆ,ê±´ë¬¼ëª…ì¹­ ë° ë²ˆí˜¸</label>
                      </th>
                      <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">

                      </td>
                    </tr>

                    <tr>
                      <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                        <label>ì†Œì¬ì§€ë²ˆ</label>
                      </th>
                      <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">

                      </td>
                    </tr>

                    <tr>
                      <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                        <label>ì§€ëª©</label>
                      </th>
                      <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">

                      </td>

                      <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                        <label>ë©´ì </label>
                      </th>
                      <td style="width: 15%; padding: 5px; border: 1px solid #ddd;">

                      </td>
                    </tr>

                    <tr>
                      <th style="text-align: center; width: 7%; padding: 5px; border: 1px solid #ddd; font-size: 13px;">
                        <label>ì±„ê¶Œìµœê³ ì•¡ë“±</label>
                      </th>
                      <td style="width: 15%; padding: 5px; border: 1px solid #ddd;" colspan="3">
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </section>

                <section class="tab-item" id="sub1">
                  <table class="write-table"
                         style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                    <caption style="text-align: left; margin-bottom: 8px;">ìƒì„¸í…Œì´ë¸”</caption>
                    <thead>
                    <tr>
                      <th colspan="4" style="text-align: center;">ê°‘ êµ¬ (ì†Œìœ ê¶Œì— ê´€í•œ ì‚¬í•­)</th>
                    </tr>
                    </thead>
                    <tbody>

                    <tr>
                      <th style="font-size: 11px;">
                        ë“±ê¸°ëª©ì 
                      </th>
                      <td colspan="3">

                      </td>
                    </tr>
                    <tr>
                      <th style="font-size: 11px;">
                        ì ‘ìˆ˜
                      </th>
                      <td colspan="3">

                      </td>
                    </tr>
                    <tr>
                      <th style="font-size: 11px;">
                        ë“±ê¸°ì›ì¸
                      </th>
                      <td colspan="3">

                      </td>
                    </tr>

                    <tr>
                      <th style="font-size: 11px; text-align: center;" colspan="4">ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­</th>

                    </tr>
                    <tr>
                      <td colspan="4">

                      </td>
                    </tr>
                    </tbody>
                  </table>
                </section>

                <section class="tab-item" id="sub2">
                  <table class="write-table"
                         style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                    <caption style="text-align: left; margin-bottom: 8px;">ìƒì„¸í…Œì´ë¸”</caption>
                    <thead>
                    <tr>
                      <th colspan="4" style="text-align: center;">ì„ êµ¬ (ì†Œìœ ê¶Œ ì´ì™¸ì˜ ê¶Œë¦¬ì— ê´€í•œ ì‚¬í•­)</th>
                    </tr>
                    </thead>
                    <tbody>

                    <tr>
                      <th style="font-size: 11px;">
                        ë“±ê¸°ëª©ì 
                      </th>
                      <td colspan="3">

                      </td>
                    </tr>
                    <tr>
                      <th style="font-size: 11px;">
                        ì ‘ìˆ˜
                      </th>
                      <td colspan="3">

                      </td>
                    </tr>
                    <tr>
                      <th style="font-size: 11px;">
                        ë“±ê¸°ì›ì¸
                      </th>
                      <td colspan="3">

                      </td>
                    </tr>

                    <tr>
                      <th style="font-size: 11px; text-align: center;" colspan="4">ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­</th>

                    </tr>
                    <tr>
                      <td colspan="4">

                      </td>
                    </tr>
                    </tbody>
                  </table>
                </section>

              </div>
            </section>

          </div>
        </div>
      </div>
      <div class="popup-button">
        <button class="btn-popup-close btn-navy">í™•ì¸</button>
      </div>
    </div>
  </div>
  <!-- PDF ë³´ê¸° íŒì—… -->
  <div class="mobile-layout-popup">
    <div class="popup-overlay"></div>
    <div class="popup-wrapper" id="popup-pdf-viewer">
      <div class="popup-title">
        <h3>PDF ë¬¸ì„œ ë³´ê¸°</h3>
      </div>
      <div class="popup-contents">
        <div class="table-wrap">
          <div class="write-wrap">
            <section>
              <div class="tab-wrap" style="width: 100%;">
                <!-- PDF ë·°ì–´ -->
                <section class="tab-item" id="pdfView" style="display: block;">
                  <div id="pdfContainer" style="
                          width: 100%;
                          height: auto;
                          padding: 10px;
                          background: #f8f9fa;
                          overflow-y: auto;
                          max-height: 600px;">
                    <!--  PDF í˜ì´ì§€ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. -->
                  </div>
                </section>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div class="popup-button">
        <button class="btn-download btn-navy" id="btnDownloadPdf" onclick="downloadPdf()">ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn-popup-close btn-navy" onclick="closeModal('popup-pdf-viewer')">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!--ì´ë ¥ë³´ê¸° íŒì—…-->
  <div class="mobile-layout-popup">
    <div class="popup-wrapper" id="popup-details">
      <div class="popup-title">
        <h3>ì´ë ¥ ë‚´ì—­</h3>
        <a title="íŒì—…ë‹«ê¸°" class="btn-popup-close">
          <img src="/assets_mobile/images/icon/btn-popup-close.svg" alt="ë‹«ê¸°">
        </a>
      </div>
      <div class="popup-contents">
        <div class="ticket-tit">
          <dl>
            <dd></dd>
          </dl>
        </div>
        <div class="table-container">
          <div class="list-table-wrap" style="overflow-x: auto;">

          </div>
        </div>
        <div class="write-wrap">
        </div>
      </div>
      <div class="popup-button">
        <button class="btn-popup-close btn-navy">í™•ì¸</button>
      </div>
    </div>
  </div>

</div> <!-- //page-wrapper end-->

<script th:inline="javascript">
  // // Thymeleafì—ì„œ ê°’ ì„¤ì •: Null ì²´í¬ì™€ ê¸°ë³¸ê°’ ì²˜ë¦¬
  // var groupid = [[${session.groupid != null ? session.groupid : 'null'}]];
  // var id = /*[[${id != null ? id : 'null'}]]*/;
  // var groupname = /*[[${groupname != null ? groupname : 'null'}]]*/;
  // var username = /*[[${username != null ? username : 'null'}]]*/;
  //
  // // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê°’ ìœ ì§€ (null ë˜ëŠ” ë¹ˆ ë¬¸ìì—´ì€ ì €ì¥í•˜ì§€ ì•ŠìŒ)
  // if (groupid && groupid !== 'null') localStorage.setItem('groupid', groupid);
  // if (id && id !== 'null') localStorage.setItem('id', id);
  // if (username && username !== 'null') localStorage.setItem('username', username);
  // if (groupname && groupname !== 'null') localStorage.setItem('groupname', groupname);
</script>


<script type="text/javascript">

  document.readyState === 'complete' ? init() : window.onload = init;
  // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
  const date = new Date();
  date.setHours(date.getHours() + 9); // UTC+9ë¡œ í•œêµ­ ì‹œê°„ ì„¤ì •
  const today = date.toISOString().split('T')[0];
  const currentYear = date.getFullYear();

  // ê¸°ë³¸ê°’ ì„¤ì • (ì˜¬í•´ 1ì›” 1ì¼ ~ ì˜¤ëŠ˜)
  document.getElementById('startDate').value = `${currentYear}-01-01`;
  document.getElementById('endDate').value = today;

  function init() {
    fetchListData();
  }

  // ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ì¹´ë“œ ë Œë”ë§
  function fetchListData() {
    $.ajax({
      url: '/api/IssueInquiry/List',
      type: 'GET',
      data: {
        'startDate': $('#startDate').val(),
        'endDate': $('#endDate').val(),
        'SearchKeywords': $('#SearchKeywords').val()
      },
      success: function (data) {
        console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„°:", data);
        if (!data || !data.data || !Array.isArray(data.data)) {
          console.error("ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          return;
        }

        //  ëª©ë¡ ê±´ìˆ˜ ì—…ë°ì´íŠ¸
        const listNumElement = document.querySelector('.list-num .blue');
        if (listNumElement) {
          listNumElement.textContent = `${data.data.length} ê±´`;
        }

        //  ì£¼ì†Œ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const listAddressWrap = document.getElementById('addressWrap');
        if (!listAddressWrap) {
          console.error("addressWrap ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        listAddressWrap.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
        const availableColors = ['card-blue', 'card-green', 'card-black', 'card-red', 'card-yellow', 'card-purple'];
        let colorIndex = 0;
        let htmlContent = '';

        const selectedValue = $('#property').val();

        data.data.forEach(item => {
          const cardColor = availableColors[colorIndex];
          colorIndex = (colorIndex + 1) % availableColors.length;

          let buttonsHtml = `
                    <div style="display: flex; gap: 5px; align-items: center; max-width: 100%;">
                        <button class="btn btn-popup-open" data-popup="popup-history" title="ìƒì„¸ë³´ê¸°" style="padding: 4px 12px;">ìƒì„¸ë³´ê¸°</button>
                        <button class="btn btn-popup-open" data-popup="popup-details" title="ì´ë ¥ë³´ê¸°" style="margin-top: 5px;margin-bottom: 5px; padding: 4px 12px;">ì´ë ¥ë³´ê¸°</button>
                        <button class="btn btn-register-view" data-realid="${item.REALID}" style="padding: 4px 12px;">ë“±ê¸°ë¶€ ë³´ê¸°</button>
                    </div>
                `;

          const formattedDate = item.RELASTDATE.substring(0, 4) + '-' + item.RELASTDATE.substring(4, 6) + '-' + item.RELASTDATE.substring(6, 8);
          const formattedLastDate = item.RLASTDATE
            ? item.RLASTDATE.substring(0, 4) + '-' + item.RLASTDATE.substring(4, 6) + '-' + item.RLASTDATE.substring(6, 8)
            : '';

          htmlContent += `
                    <div class="card-box ${cardColor}" data-realadd="${item.REALADD}" data-resido="${item.RESIDO}" data-realid="${item.REALID}"
                        data-regdate="${item.REGDATE}" data-regugun="${item.REGUGUN}" data-rejimok="${item.REJIMOK}" data-rearea="${item.REAREA}"
                        data-PDFFILENAME="${item.PDFFILENAME}" data-remaxamt="${item.REMAXAMT}" data-uniqueNo="${item.UniqueNo}" style="margin-bottom:10px;">
                        <div class="card-cont">
                            <dl>
                                <dt>ì§‘í•©ê±´ë¬¼</dt>
                                <dd>${item.REALGUBUN}</dd>
                            </dl>
                            <dl>
                                <dt>ì£¼ì†Œ</dt>
                                <dd>${item.REALADD}</dd>
                            </dl>
                            ${
            (selectedValue === "most_viewed_property" || selectedValue === "popular_property")
              ? `<dl>
                                    <dt>ìµœê·¼ì¡°íšŒë‚ ì§œ</dt>
                                    <dd>${formattedLastDate}</dd>
                                  </dl>`
              : `<dl>
                                    <dt>ì¡°íšŒë‚ ì§œ</dt>
                                    <dd>${formattedDate}</dd>
                                  </dl>`
          }
                            <dl>
                                <dt>íŒì •ì ìˆ˜</dt>
                                <dd>${item.REALSCORE}</dd>
                            </dl>
                            ${
            (selectedValue === "most_viewed_property" || selectedValue === "popular_property")
              ? `<dl>
                                    <dt>ì¡°íšŒìˆ˜</dt>
                                    <dd>${item.record_count}</dd>
                                  </dl>`
              : ''
          }
                        </div>
                        ${buttonsHtml}
                    </div>
                `;
        });

        listAddressWrap.innerHTML = htmlContent;

        //  ì´ë²¤íŠ¸ ìœ„ì„ì„ ì‚¬ìš©í•˜ì—¬ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
        listAddressWrap.addEventListener('click', (event) => {
          const button = event.target.closest('.btn-popup-open[data-popup="popup-history"]');
          const pdfButton = event.target.closest('.btn-register-view');
          const delButton = event.target.closest('.btn-popup-open[data-popup="popup-details"]');

          if (button) {
            const cardBox = button.closest('.card-box');
            const realId = cardBox.getAttribute('data-realid');
            if (!cardBox) return;

            console.log(" ìƒì„¸ë³´ê¸° í´ë¦­ë¨! REALID:", realId);

            //AJAX ìš”ì²­ì„ í†µí•´ ìƒì„¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            $.ajax({
              url: `/api/IssueInquiry/DetailsList?realId=${realId}`,
              data: {
                'startDate': $('#startDate').val(),
                'endDate': $('#endDate').val(),
              },
              type: 'GET',
              success: function (data) {
                console.log("ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ìƒì„¸ ë°ì´í„°:", data);

                // íŒì—… ì œëª© ì—…ë°ì´íŠ¸
                document.querySelector("#popup-history .popup-title h3").textContent = data.REALADD + " ìƒì„¸ë‚´ìš©";

                const cardBox = button.closest('.card-box');

                const realAdd = cardBox.getAttribute('data-realadd');
                const resido = cardBox.getAttribute('data-resido') || '';
                const regdate = cardBox.getAttribute('data-regdate') || '';
                const regugun = cardBox.getAttribute('data-regugun') || '';
                const rejimok = cardBox.getAttribute('data-rejimok') || '';
                const rearea = cardBox.getAttribute('data-rearea') || '';
                const uniqueNo = data.UniqueNo ? data.UniqueNo : "";
                const uniqueNoSafe = (uniqueNo === null || uniqueNo === "null") ? '' : uniqueNo;
                const remaxamt = cardBox.getAttribute('data-remaxamt') || '';
                const numericRemaxamt = !isNaN(remaxamt) && remaxamt.trim() !== '' ? Number(remaxamt) : 0;
                const formattedRemaxamt = numericRemaxamt.toLocaleString(undefined, {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2
                });

                // íŒì—… íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
                const popupTitle = document.querySelector("#popup-history .popup-title h3");
                if (popupTitle) {
                  popupTitle.textContent = `${realAdd} ìƒì„¸ë‚´ìš©`;
                }
                // ë‚ ì§œ í¬ë§· ë³€ê²½
                const formattedRegDate = regdate
                  ? regdate.substring(0, 4) + 'ë…„' + regdate.substring(4, 6) + 'ì›”' + regdate.substring(6, 8) + 'ì¼'
                  : '';

                // í‘œì œë¶€
                const tds = document.querySelectorAll("#popup-history td[colspan='3']");
                if (tds.length >= 4) {  // ìµœì†Œ 4ê°œ ì´ìƒ ìˆì–´ì•¼ í•¨
                  tds[0].textContent = formattedRegDate && formattedRegDate !== "null" ? formattedRegDate : "-";
                  tds[1].textContent = realAdd && realAdd !== "null" ? realAdd + " " + (uniqueNoSafe && uniqueNoSafe !== "null" ? uniqueNoSafe : "-") : "-";
                  tds[2].textContent = resido && resido !== "null" ? resido + " " + (regugun && regugun !== "null" ? regugun : "-") : "-";
                  tds[3].textContent = formattedRemaxamt && formattedRemaxamt !== "null" ? formattedRemaxamt : "-";
                } else {
                  console.warn("í•´ë‹¹ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ê°œìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                }

                const rows = document.querySelector("#popup-history table tbody").getElementsByTagName("tr");
                if (rows.length >= 4) {  // 4ë²ˆì§¸ í–‰ì´ ìˆëŠ”ì§€ í™•ì¸
                  const tds = rows[3].getElementsByTagName("td");
                  if (tds.length >= 2) {  // ìµœì†Œ 2ê°œì˜ tdê°€ ìˆì–´ì•¼ í•¨
                    tds[0].textContent = rejimok && rejimok !== "null" ? rejimok : "-";
                    tds[1].textContent = rearea && rearea !== "null" ? rearea : "-";
                  } else {
                    console.warn("4ë²ˆì§¸ í–‰ì˜ td ê°œìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                  }
                } else {
                  console.warn("4ë²ˆì§¸ í–‰ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
                // í…Œì´ë¸” ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                const sub1Table = document.querySelector("#sub1 table tbody");
                const sub2TableBody = document.querySelector("#sub2 table tbody");

                if (!sub1Table || !sub2TableBody) {
                  console.error("ì˜¤ë¥˜: sub1Table ë˜ëŠ” sub2TableBodyì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                  return;
                }

                // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë°›ì•„ì„œ ì¤‘ë³µ ì œê±° í›„ ì‚¬ìš©
                let details = Array.isArray(data.data) && data.data.length > 0 ? data.data : [];

                if (details.length === 0) {
                  console.warn("Aë“±ê¸° ë°ì´í„° ì—†ìŒ");
                } else {
                  let tableBody = document.querySelector("#sub1 table tbody");
                  tableBody.innerHTML = ""; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”

                  details.forEach((entry) => {
                    // null ë˜ëŠ” undefinedë¥¼ "-"ë¡œ ëŒ€ì²´í•˜ëŠ” í•¨ìˆ˜
                    const safeValue = (value) => value && value !== "null" ? value : "-";

                    // ë“±ê¸° ëª©ì  í–‰
                    let row1 = document.createElement("tr");
                    row1.innerHTML = `
            <th style="font-size: 11px;">ë“±ê¸°ëª©ì </th>
            <td colspan="3">${safeValue(entry.RgsAimCont_A)}</td>
        `;
                    tableBody.appendChild(row1);

                    // ì ‘ìˆ˜ í–‰
                    let row2 = document.createElement("tr");
                    row2.innerHTML = `
            <th style="font-size: 11px;">ì ‘ìˆ˜</th>
            <td colspan="3">${safeValue(entry.Receve_A)}</td>
        `;
                    tableBody.appendChild(row2);

                    // ë“±ê¸° ì›ì¸ í–‰
                    let row3 = document.createElement("tr");
                    row3.innerHTML = `
            <th style="font-size: 11px;">ë“±ê¸°ì›ì¸</th>
            <td colspan="3">${safeValue(entry.RgsCaus_A)}</td>
        `;
                    tableBody.appendChild(row3);

                    // ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­ ì œëª©
                    let row4 = document.createElement("tr");
                    row4.innerHTML = `
            <th style="font-size: 11px; text-align: center;" colspan="4">ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­</th>
        `;
                    tableBody.appendChild(row4);

                    // ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­ ë°ì´í„°
                    let row5 = document.createElement("tr");
                    row5.innerHTML = `
            <td colspan="4">${safeValue(entry.NomprsAndEtc_A)}</td>
        `;
                    tableBody.appendChild(row5);
                  });
                }

                // ì„êµ¬
                if (details.length === 0) {
                  console.warn("Bë“±ê¸° ë°ì´í„° ì—†ìŒ");
                } else {
                  let tableBody = document.querySelector("#sub2 table tbody"); // Aë“±ê¸° ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ ë³€ê²½
                  tableBody.innerHTML = ""; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™” ì¶”ê°€

                  details.forEach((entry) => {
                    // null ë˜ëŠ” undefinedë¥¼ "-"ë¡œ ëŒ€ì²´í•˜ëŠ” í•¨ìˆ˜
                    const safeValue = (value) => value && value !== "null" ? value : "-";

                    // ë“±ê¸°ëª©ì  í–‰ ì¶”ê°€
                    let row1 = document.createElement("tr");
                    row1.innerHTML = `
            <th style="font-size: 11px;">ë“±ê¸°ëª©ì </th>
            <td colspan="3">${safeValue(entry.RgsAimCont_B)}</td>
        `;
                    tableBody.appendChild(row1);

                    // ì ‘ìˆ˜ í–‰ ì¶”ê°€
                    let row2 = document.createElement("tr");
                    row2.innerHTML = `
            <th style="font-size: 11px;">ì ‘ìˆ˜</th>
            <td colspan="3">${safeValue(entry.Receve_B)}</td>
        `;
                    tableBody.appendChild(row2);

                    // ë“±ê¸° ì›ì¸ í–‰ ì¶”ê°€
                    let row3 = document.createElement("tr");
                    row3.innerHTML = `
            <th style="font-size: 11px;">ë“±ê¸°ì›ì¸</th>
            <td colspan="3">${safeValue(entry.RgsCaus_B)}</td>
        `;
                    tableBody.appendChild(row3);

                    // ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­ ì œëª© í–‰ ì¶”ê°€
                    let row4 = document.createElement("tr");
                    row4.innerHTML = `
            <th style="font-size: 11px; text-align: center;" colspan="4">ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­</th>
        `;
                    tableBody.appendChild(row4);

                    // ê¶Œë¦¬ì ë° ê¸°íƒ€ì‚¬í•­ ë°ì´í„° í–‰ ì¶”ê°€
                    let row5 = document.createElement("tr");
                    row5.innerHTML = `
            <td colspan="4">${safeValue(entry.NomprsAndEtc_B)}</td>
        `;
                    tableBody.appendChild(row5);
                  });
                }

                // íŒì—… ì—´ê¸°
                document.getElementById("popup-history").classList.add("open");
              },
              error: function (xhr, status, error) {
                console.error("ìƒì„¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
              }
            });
          }
          if (pdfButton) {  // PDF ë³´ê¸° ë²„íŠ¼ì´ í´ë¦­ëœ ê²½ìš°
            const realId = pdfButton.getAttribute("data-realid");
            if (!realId) return;

            console.log("PDF ë³´ê¸° í´ë¦­ë¨! REALID:", realId);
            openModal('popup-pdf-viewer', `/api/IssueInquiry/pdf?realId=${realId}`, realId);
          }

          if (delButton) {
            const cardBox = delButton.closest('.card-box');
            if (!cardBox) return;

            const realid = cardBox.getAttribute("data-realid");
            const address = cardBox.getAttribute('data-realadd') || "ì£¼ì†Œ ì •ë³´ ì—†ìŒ";

            if (!realid) {
              console.warn("REALID ì—†ìŒ!");
              return;
            }

            console.log("ì´ë ¥ë³´ê¸° ë²„íŠ¼ í´ë¦­ë¨! REALID, address:", realid, address);

            handleClick(realid, address);
          }
        });
      },
      error: function (xhr, status, error) {
        console.error("AJAX ìš”ì²­ ì‹¤íŒ¨:", status, error);
        console.error("ì‘ë‹µ ë‚´ìš©:", xhr.responseText);
      }
    });
  }

  let currentRealId = null;

  function openModal(popupId, pdfUrl = null, realId = null) {
    let popup = document.getElementById(popupId);
    let overlay = document.querySelector('.popup-overlay');
    let container = document.getElementById("pdfContainer");

    console.log(" openModal ì‹¤í–‰ë¨! popupId:", popupId, "PDF URL:", pdfUrl);

    if (!popup) {
      console.error(` íŒì—… ID (${popupId})ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
      return;
    }

    // íŒì—… ê°•ì œ í‘œì‹œ
    popup.style.display = "block";
    setTimeout(() => {
      popup.classList.add("active");
      popup.style.opacity = "1";
      popup.style.visibility = "visible";
    }, 10);

    if (overlay) {
      overlay.style.display = "block";
      overlay.classList.add("active");
    }
    if (realId) {
      currentRealId = realId;
      //  console.log(" ì „ì—­ ë³€ìˆ˜ì— realId ì €ì¥ ì™„ë£Œ:", realId);
    } else {
      // console.warn(" realId ê°’ì´ ì „ë‹¬ë˜ì§€ ì•ŠìŒ!");
    }

    // PDF íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ PDF.jsë¡œ ë Œë”ë§
    if (pdfUrl) {
      console.log(" PDF URL í™•ì¸:", pdfUrl);

      fetch(pdfUrl, {method: 'GET', mode: 'cors'})
        .then(response => {
          if (!response.ok) {
            throw new Error(' PDF íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
          // console.log(" PDF íŒŒì¼ í™•ì¸ ì™„ë£Œ:", pdfUrl);

          // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™” í›„ PDF ë Œë”ë§
          container.innerHTML = "";
          showPdf(pdfUrl);
        })
        .catch(error => {
          console.error(error.message);
          Alert.alert('', "PDF íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          container.innerHTML = "<p style='color:red;'>PDFë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        });
    }
  }

  function closeModal(popupId) {
    let popup = document.getElementById('popup-pdf-viewer');
    let overlay = document.querySelector('.popup-overlay');
    let iframe = document.getElementById("pdfFrame");
    //console.log(" closeModal ì‹¤í–‰ë¨! popupId:", popupId);
    if (!popup) {
      console.error(` ë‹«ì„ íŒì—… ID (${popupId})ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
      return;
    }

    // í•´ë‹¹ íŒì—…ë§Œ ë‹«ê¸°
    popup.classList.remove("active");
    setTimeout(() => {
      popup.style.display = "none";
    }, 300);

    // íŒì—…ì´ ëª¨ë‘ ë‹«í˜”ì„ ê²½ìš°, ì˜¤ë²„ë ˆì´ë„ ë‹«ê¸°
    let allActivePopups = document.querySelectorAll('.mobile-layout-popup.active');
    if (allActivePopups.length === 0 && overlay) {
      overlay.classList.remove("active");
    }

    // iframe ì´ˆê¸°í™” (PDF URL ì œê±°)
    if (iframe) {
      iframe.src = "";
    }
  }

  //  PDF ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
  function downloadPdf() {
    if (!currentRealId) {
      console.error(" ë‹¤ìš´ë¡œë“œí•  PDF íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (realId ì—†ìŒ)");
      Alert.alert('', "ë‹¤ìš´ë¡œë“œí•  PDF íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    console.log(" PDF ë‹¤ìš´ë¡œë“œ ì‹œì‘: realId=", currentRealId);

    //`pdfDownload` API í˜¸ì¶œí•˜ì—¬ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
    let downloadUrl = `/api/IssueInquiry/pdfDownload?realId=${currentRealId}`;
    // console.log(" ë‹¤ìš´ë¡œë“œ URL:", downloadUrl);  // ğŸ” ë””ë²„ê¹… í™•ì¸

    //ê°•ì œ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
    let anchor = document.createElement("a");
    anchor.href = downloadUrl;
    anchor.target = "_blank";
    anchor.download = "ë“±ê¸°ë¶€ë“±ë³¸.pdf"; //ê¸°ë³¸ íŒŒì¼ëª… ì„¤ì • (ì„œë²„ì—ì„œ ë®ì–´ì”Œì›€)
    document.body.appendChild(anchor);
    anchor.click();
    document.body.removeChild(anchor);
  }

  function showPdf(pdfUrl) {
    console.log(" PDF.jsë¥¼ ì‚¬ìš©í•˜ì—¬ PDF ë Œë”ë§:", pdfUrl);

    let container = document.getElementById("pdfContainer");
    container.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

    // ğŸ›  ìŠ¤í¬ë¡¤ ë‹¨ì¼í™” (ì´ì¤‘ ìŠ¤í¬ë¡¤ ì œê±°)
    container.style.overflowX = "hidden"; // ê°€ë¡œ ìŠ¤í¬ë¡¤ ì œê±°
    container.style.overflowY = "hidden"; // ì´ì¤‘ ìŠ¤í¬ë¡¤ ë°©ì§€
    container.style.maxHeight = "100vh";  // ì „ì²´ í™”ë©´ ë†’ì´ ì‚¬ìš©

    // PDF íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
    pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
      console.log(" PDF ë¡œë“œ ì™„ë£Œ. ì´ í˜ì´ì§€ ìˆ˜:", pdf.numPages);

      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        pdf.getPage(pageNum).then(page => {
          let viewport = page.getViewport({scale: 1.5}); // ê¸°ë³¸ ìŠ¤ì¼€ì¼

          // ğŸ›  ì»¨í…Œì´ë„ˆ ë„ˆë¹„ì— ë§ì¶° PDFë¥¼ ìë™ í™•ëŒ€ (ì—¬ë°± ì—†ì´ ê½‰ ì°¨ê²Œ)
          let scale = container.clientWidth / viewport.width;
          let scaledViewport = page.getViewport({scale: scale});

          // í˜ì´ì§€ë³„ <canvas> ìƒì„±
          let canvas = document.createElement("canvas");
          canvas.classList.add("pdf-page");
          container.appendChild(canvas);

          let context = canvas.getContext("2d");

          // ğŸ›  PDF í¬ê¸°ë¥¼ ì»¨í…Œì´ë„ˆì— ë§ê²Œ ì„¤ì • (ì—¬ë°± ì œê±°)
          let scaleFactor = 3; // 3ë°° í™•ëŒ€
          canvas.width = scaledViewport.width * scaleFactor;
          canvas.height = scaledViewport.height * scaleFactor;
          canvas.style.width = "100%"; // ì»¨í…Œì´ë„ˆì— ë§ê²Œ ê½‰ ì±„ìš°ê¸°
          canvas.style.height = "auto"; // ì„¸ë¡œ ë¹„ìœ¨ ìœ ì§€

          // ê³ í•´ìƒë„ ë Œë”ë§ (í…ìŠ¤íŠ¸ ì„ ëª…í•˜ê²Œ)
          let renderContext = {
            canvasContext: context,
            viewport: scaledViewport,
            transform: [scaleFactor, 0, 0, scaleFactor, 0, 0]
          };

          page.render(renderContext);
        });
      }
    }).catch(error => {
      console.error(" PDF ë Œë”ë§ ì˜¤ë¥˜:", error);
      alert(" PDFë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    });
  }

  /*ì´ë ¥ ë³´ê¸° íŒì—… ë‚´ìš© */
  function handleClick(realid, address) {
    $.ajax({
      url: "/api/IssueInquiry/popupDetails",
      type: "GET",
      data: {realid: realid},
      headers: {
        'X-CSRF-Token': $('[name=_csrf]').val()
      },
      success: function (response) {
        console.log("ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„°(ì´ë ¥ ë³´ê¸°):", response);

        if (response.success) {
          let regDateMap = {};
          let regScoreMap = {};

          if (response.findPinNO && response.findPinNO.length > 0) {
            response.findPinNO.forEach(item => {
              if (item.REALID) {
                regDateMap[item.REALID] = item.INDATEM || '';
                regScoreMap[item.REALID] = item.REALSCORE || '';
              }
            });
          }

          let listData = {
            REALID: realid,
            SHORT_ADDR: address // ë°›ì•„ì˜¨ ì£¼ì†Œê°’ ì‚¬ìš©
          };

          let transformedDataA = response.findnK ? response.findnK.map(item => ({
            ...item,
            INDATEM: regDateMap[item.REALID] || 'ë¯¸í™•ì¸',
            REALSCORE: regScoreMap[item.REALID] || 'ë¯¸í™•ì¸',
            displayText: `[ê°‘êµ¬] ${item.RgsAimCont}`
          })) : [];

          let transformedDataB = response.findnE ? response.findnE.map(item => ({
            ...item,
            INDATEM: regDateMap[item.REALID] || 'ë¯¸í™•ì¸',
            REALSCORE: regScoreMap[item.REALID] || 'ë¯¸í™•ì¸',
            displayText: `[ì„êµ¬] ${item.RgsAimCont}`
          })) : [];

          updatePopupContent(transformedDataA, transformedDataB, listData);
          $('.list-card-wrap').scrollTop(0);
        } else {
          console.warn("ë°ì´í„° ì—†ìŒ:", response.message);
          Alert.alert('', "í•´ë‹¹ ë¬¼ê±´ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      },
      error: function (xhr, status, error) {
        console.error("AJAX ìš”ì²­ ì‹¤íŒ¨:", status, error);
        Alert.alert("ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    });
  }

  function formatDateTo12Hour(indatem) {
    if (!indatem) return "ë¯¸í™•ì¸";

    let dateObj = new Date(indatem);
    let year = dateObj.getFullYear();
    let month = String(dateObj.getMonth() + 1).padStart(2, '0');
    let day = String(dateObj.getDate()).padStart(2, '0');
    let hours = dateObj.getHours();
    let minutes = String(dateObj.getMinutes()).padStart(2, '0');
    let period = hours >= 12 ? "PM" : "AM";

    hours = hours % 12 || 12; // 12ì‹œê°„ì œ ë³€í™˜

    return `${year}-${month}-${day} ${hours}:${minutes} ${period}`;
  }

  function updatePopupContent(findnK, findnE, listData) {
    let popup = document.getElementById('popup-details');
    let overlay = document.querySelector('.popup-overlay');
    let listContainer = document.querySelector('.list-table-wrap');
    let addressField = document.querySelector('#popup-details .ticket-tit dd');

    addressField.textContent = listData?.SHORT_ADDR ?? 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ';

    listContainer.innerHTML = '';

    let allData = [...findnK.map(item => ({...item, type: 'K'})),
      ...findnE.map(item => ({...item, type: 'E'}))];

    if (allData.length === 0) {
      console.warn("ë“±ê¸°ë¶€ë“±ë³¸ ë°ì´í„° ì—†ìŒ");
      Alert.alert('', "ë³„ë„ì˜ ë“±ê¸°ëª©ì ì´ ì—†ìŠµë‹ˆë‹¤.");
      listContainer.innerHTML = '<p style="text-align: center; padding: 10px;">í•´ë‹¹ ë¬¼ê±´ì˜ ë“±ê¸°ë¶€ë“±ë³¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }

    let groupedData = {};
    allData.forEach(item => {
      let indateTime = formatDateTo12Hour(item.INDATEM);
      let realId = item.REALID;
      let realScore = item.REALSCORE || '';

      let groupKey = `${indateTime}_${realId}`;

      if (!groupedData[groupKey]) {
        groupedData[groupKey] = {
          items: [],
          realScores: new Set()
        };
      }
      groupedData[groupKey].items.push(item);
      groupedData[groupKey].realScores.add(realScore);
    });

    Object.keys(groupedData)
      .sort((a, b) => {
        let [indateTimeA] = a.split("_");
        let [indateTimeB] = b.split("_");

        let dateA = new Date(indateTimeA);
        let dateB = new Date(indateTimeB);
        return dateB - dateA;
      })
      .forEach(groupKey => {
        let {items, realScores} = groupedData[groupKey];
        let [indateTime, realId] = groupKey.split("_");

        let realScoreText = Array.from(realScores).join(", ");
        let cardClass = getCardClassByScore(realScoreText);

        let tableHtml = `
                <table class="register-table" style="width: 100%; border-collapse: collapse; margin-bottom: 15px; overflow-x: auto;">
                    <thead>
                        <tr class="${cardClass}" style="background-color: #f2f2f2;">
                            <th colspan="7" style="padding: 8px; text-align: left;">ë°œê¸‰ì¼ì: ${indateTime} &nbsp;&nbsp;&nbsp;&nbsp; ì ìˆ˜: ${realScoreText}</th>
                        </tr>
                        <tr>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:80px;">ìˆœìœ„ë²ˆí˜¸</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:200px;">ë“±ê¸° ëª©ì </th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:200px;">ëŒ€ìƒ ì†Œìœ ì</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:400px;text-align: left;">ì£¼ìš” ë“±ê¸°ì‚¬í•­</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:300px;">ì ‘ìˆ˜ì •ë³´</th>
                            <th style="padding: 8px; border: 1px solid #ddd;min-width:80px;">êµ¬ë¶„</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        items.forEach(item => {
          let sectionName = item.type === 'K' ? 'ê°‘êµ¬' : 'ì„êµ¬';

          tableHtml += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${item?.RankNo || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item?.Purpose || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item?.TargetOwner || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;text-align: left;">${item?.Information || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item?.ReceiptInfo || ''}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${sectionName}</td>
                    </tr>
                `;
        });

        tableHtml += `
                    </tbody>
                </table>
            `;

        listContainer.innerHTML += tableHtml;
      });

    popup.classList.add('active');
    overlay.style.display = 'block';
    popup.scrollTop = 0;
  }

  //ì ìˆ˜ë³„ ì¹´ë“œ ìƒ‰
  function getCardClassByScore(score) {
    if (score === "ë¯¸í™•ì¸") return "card-white"; // ì ìˆ˜ ì—†ìŒ (S ë“±ê¸‰: ì•ˆì‹¬)
    let numericScore = parseFloat(score); // ì ìˆ˜ë¥¼ ìˆ«ìë¡œ ë³€í™˜

    if (numericScore >= 90) return "card-white"; // S ë“±ê¸‰ (ì•ˆì‹¬)
    if (numericScore >= 80) return "card-green"; // A ë“±ê¸‰ (ê´€ì‹¬)
    if (numericScore >= 70) return "card-blue";  // B ë“±ê¸‰ (ì£¼ì˜)
    if (numericScore >= 60) return "card-yellow"; // C ë“±ê¸‰ (ê²½ê³„)
    if (numericScore >= 50) return "card-orange"; // D ë“±ê¸‰ (ë¶ˆì•ˆ)
    if (numericScore >= 40) return "card-red";   // E ë“±ê¸‰ (ì‹¬ê°)
    return "card-black"; // F ë“±ê¸‰ (ìœ„í—˜)
  }

  function handleSearch() {
    fetchListData();
    closeSearch();
  }

  // ì¡°íšŒë²„íŠ¼ í´ë¦­ì‹œ ê²€ìƒ‰ì°½ close
  function closeSearch() {
    document.querySelector('.btn-aco').click();
  }

  $('.btn-popup-close').on('click', function () {
    $('.popup-overlay').fadeOut(200);
    $('.popup-wrapper').removeClass('active');

    $('.popup-contents').scrollTop(0).scrollLeft(0);
    $('.list-table-wrap').scrollTop(0).scrollLeft(0);
  });

</script>
</body>
</html>
